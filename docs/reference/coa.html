<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The centres of activity (COA) algorithm — coa • flapper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="The centres of activity (COA) algorithm — coa" />
<meta property="og:description" content="This function implements the arithmetic mean-position algorithm to calculate an individual's centres of activity (COAs) though time from detections at passive acoustic telemetry receivers, as described by Simpfendorfer et al (2002). Under this approach, each COA is calculated as the arithmetic mean of the locations of receivers at which an individual was detected over a specified time interval, weighted by the frequency of detections at each of those receivers. To implement the function, a detection matrix that defines the number of detections of an individual along sequence of time steps at each receiver (e.g., from make_matrix_detections) needs to be supplied, along a matrix of receiver locations in a planar coordinate system. For each time interval, the function calculates the centre of activity and returns a matrix or dataframe with this information." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/edwardlavender/flapper/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>The centres of activity (COA) algorithm</h1>
    <small class="dont-index">Source: <a href='https://github.com/edwardlavender/flapper/blob/master/R/coa.R'><code>R/coa.R</code></a></small>
    <div class="hidden name"><code>coa.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function implements the arithmetic mean-position algorithm to calculate an individual's centres of activity (COAs) though time from detections at passive acoustic telemetry receivers, as described by Simpfendorfer et al (2002). Under this approach, each COA is calculated as the arithmetic mean of the locations of receivers at which an individual was detected over a specified time interval, weighted by the frequency of detections at each of those receivers. To implement the function, a detection matrix that defines the number of detections of an individual along sequence of time steps at each receiver (e.g., from <code><a href='make_matrix_detections.html'>make_matrix_detections</a></code>) needs to be supplied, along a matrix of receiver locations in a planar coordinate system. For each time interval, the function calculates the centre of activity and returns a matrix or dataframe with this information.</p>
    </div>

    <pre class="usage"><span class='fu'>coa</span><span class='op'>(</span>
  <span class='va'>mat</span>,
  <span class='va'>xy</span>,
  cl <span class='op'>=</span> <span class='cn'>NULL</span>,
  varlist <span class='op'>=</span> <span class='cn'>NULL</span>,
  na_omit <span class='op'>=</span> <span class='cn'>TRUE</span>,
  as_POSIXct <span class='op'>=</span> <span class='va'>as.POSIXct</span>,
  output <span class='op'>=</span> <span class='st'>"matrix"</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mat</th>
      <td><p>A detection matrix, with one row for each time step and one column for each receiver, in which each cell defines the number of detections at each time step/receiver (for a particular individual) (see <code><a href='make_matrix_detections.html'>make_matrix_detections</a></code>). It is advisable that the rows and columns of this matrix are labelled by time stamp and receiver respectively, especially if there are any rows without detections (see <code>output</code> below).</p></td>
    </tr>
    <tr>
      <th>xy</th>
      <td><p>A matrix that defines receiver locations (x, y). This should contain one row for each receiver (column) in <code>mat</code> (in the same order as in <code>mat</code>) and two columns for the coordinates. Planar coordinates (i.e., in Universal Transverse Mercator projection) are required for the averaging process.</p></td>
    </tr>
    <tr>
      <th>cl, varlist</th>
      <td><p>(optional) Parallelisation options. <code>cl</code> is (a) a cluster object from <code><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></code> or (b) an integer that defines the number of child processes. <code>varlist</code> is a character vector of variables for export (see <code><a href='cl.html'>cl_export</a></code>). Exported variables must be located in the global environment. If a cluster is supplied, the connection to the cluster is closed within the function (see <code><a href='cl.html'>cl_stop</a></code>). For further information, see <code><a href='cl.html'>cl_lapply</a></code> and <code><a href='flapper-tips-parallel.html'>flapper-tips-parallel</a></code>.</p></td>
    </tr>
    <tr>
      <th>na_omit, as_POSIXct</th>
      <td><p>Processing options. <code>na_omit</code> is a logical variable that defines whether or not to omit NAs (i.e., rows in <code>mat</code> for which no detections were made and thus for which COAs cannot be calculated) from returned coordinates. If <code>output = "data.frame"</code> (see below), <code>as_POSIXct</code> is a function to convert time stamps, taken from the row names of <code>mat</code>, to a POSIXct vector. <code>as_POSIXct = NULL</code> suppresses this conversion.</p></td>
    </tr>
    <tr>
      <th>output</th>
      <td><p>A character that defines the output format. Currently supported options are: <code>"matrix"</code>, which returns a matrix of the coordinates of COAs; and <code>"data.frame"</code>, which returns a dataframe with timestamps (taken from the row names of <code>mat</code>) and COA coordinates.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns a matrix or a dataframe, depending on the <code>output</code> argument, that represents a time series of COAs. If <code>na_omit = TRUE</code>, the time series may have `gaps' over which COAs could not be calculated due to the absence of detections.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Centres of activity (COA) are a widely used metric for the reconstruction of patterns of space use from passive acoustic telemetry detections. Several methods have been developed to calculate COAs, but the mean-position algorithm is the commonest. Under this approach, COAs are estimated as an average of the locations of receivers at which an individual is detected over a specified time interval, weighted by the frequency of detections at each of those receivers. Within <code><a href='flapper.html'>flapper</a></code>, COAs are calculated in three stages by first exploring possible time intervals over which to calculate COAs with <code><a href='coa_setup_delta_t.html'>coa_setup_delta_t</a></code>; then summarising detections over those intervals with <code><a href='make_matrix_detections.html'>make_matrix_detections</a></code>; and finally passing the resultant detection matrix to the <code>coa</code> function to calculate COAs. This implements the arithmetic version of the mean-position algorithm, calculating the arithmetic mean of the receiver locations, weighted by the frequency of detections at each receiver.</p>
<p>To generate estimates of space use, COAs are usually taken as point estimates from which utilisation distributions (typically kernel utilisation distributions, KUDs) are estimated. Thus, in the case of a coupled COA-KUD approach, usually the estimate of space use is a (kernel) utilisation distribution which describes the probability of relocating an individual in any given area at a randomly chosen time. Alternative methods of home range analysis, including those which incorporate time, such as dynamic Brownian bridge movement models, can be used to estimate the utilisation distribution. Generally, the COA approach is most suitable when detections are relatively frequent, and receivers are regularly distributed across an area. Under other conditions, its performance as a method for estimating space use has been subject to relatively limited evaluation but it can be problematic (e.g., in clustered arrays).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Simpfendorfer, C. A., M. R. Heupel, and R. E. Hueter. 2002. Estimation of short-term centers of activity from an array of omnidirectional hydrophones and its use in studying animal movements. Canadian Journal of Fisheries and Aquatic Sciences 59:23-32.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='coa_setup_delta_t.html'>coa_setup_delta_t</a></code> suggests suitable time intervals over which to calculate COAs. <code><a href='make_matrix_detections.html'>make_matrix_detections</a></code> makes the detection matrices from detection time series data required by this function. For data in the VEMCO Vue export format, the `COA' function in the VTrack package (https://github.com/RossDwyer/VTrack) can also be used to calculate centres of activity.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Edward Lavender</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#### Define data for the calculation of COAs</span>

<span class='co'>## (1) Define the period over which to calculate COAs</span>
<span class='co'># ... by focusing on the time over which IDs were at liberty.</span>
<span class='va'>dat_ids</span><span class='op'>$</span><span class='va'>tag_start_date</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='va'>dat_ids</span><span class='op'>$</span><span class='va'>tag_start_date</span><span class='op'>)</span>
<span class='va'>dat_ids</span><span class='op'>$</span><span class='va'>tag_end_date</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='st'>"2017-06-02"</span><span class='op'>)</span>

<span class='co'>## (2) Define the receivers over which to calculate detections</span>
<span class='co'># ... Here we use factors to ensure that the order of receiver coordinates</span>
<span class='co'># ... (see below) and the order or receivers in the detection matrix</span>
<span class='co'># ... matches.</span>
<span class='va'>dat_moorings</span><span class='op'>$</span><span class='va'>receiver_id</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>dat_moorings</span><span class='op'>$</span><span class='va'>receiver_id</span><span class='op'>)</span>
<span class='va'>dat_acoustics</span><span class='op'>$</span><span class='va'>receiver_id</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>dat_acoustics</span><span class='op'>$</span><span class='va'>receiver_id</span>,
                                    levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>dat_moorings</span><span class='op'>$</span><span class='va'>receiver_id</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## (3) Define the detection matrix</span>
<span class='co'># ... Here we simply create a detection matrix across all IDs and using</span>
<span class='co'># ... a convenient (but unjustified) delta_t value. In reality, we would need</span>
<span class='co'># ... to consider the time series for which to calculate</span>
<span class='co'># ... COAs and the appropriate delta t value(s) more carefully.</span>
<span class='va'>detection_matrix_by_id</span> <span class='op'>&lt;-</span> <span class='fu'><a href='make_matrix_detections.html'>make_matrix_detections</a></span><span class='op'>(</span><span class='va'>dat_acoustics</span>,
                                                 delta_t <span class='op'>=</span> <span class='st'>"days"</span>,
                                                 start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>dat_ids</span><span class='op'>$</span><span class='va'>tag_start_date</span><span class='op'>)</span>,
                                                 end <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>dat_ids</span><span class='op'>$</span><span class='va'>tag_end_date</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::make_matrix_detections() called (@ 2022-06-17 09:59:27)... 
#&gt; ... Checking user inputs... 
#&gt; ... Defining time bins given 'delta_t'... 
#&gt; ... Making detection matrix... 
#&gt; ... flapper::make_matrix_detections() call completed (@ 2022-06-17 09:59:27) after ~0 minutes. </div><div class='input'>
<span class='co'>## (4) Define receiver coordinates with UTM projection</span>
<span class='va'>proj_wgs84</span> <span class='op'>&lt;-</span> <span class='fu'>sp</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/CRS-class.html'>CRS</a></span><span class='op'>(</span>SRS_string <span class='op'>=</span> <span class='st'>"EPSG:4326"</span><span class='op'>)</span>
<span class='va'>proj_utm</span>   <span class='op'>&lt;-</span> <span class='fu'>sp</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/CRS-class.html'>CRS</a></span><span class='op'>(</span>SRS_string <span class='op'>=</span> <span class='st'>"EPSG:32629"</span><span class='op'>)</span>
<span class='va'>xy</span> <span class='op'>&lt;-</span> <span class='fu'>sp</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/SpatialPoints.html'>SpatialPoints</a></span><span class='op'>(</span><span class='va'>dat_moorings</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"receiver_long"</span>, <span class='st'>"receiver_lat"</span><span class='op'>)</span><span class='op'>]</span>,
                        <span class='va'>proj_wgs84</span><span class='op'>)</span>
<span class='va'>xy</span> <span class='op'>&lt;-</span> <span class='fu'>sp</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/spTransform.html'>spTransform</a></span><span class='op'>(</span><span class='va'>xy</span>, <span class='va'>proj_utm</span><span class='op'>)</span>
<span class='va'>xy</span> <span class='op'>&lt;-</span> <span class='fu'>sp</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>xy</span><span class='op'>)</span>

<span class='co'>#### Example (1): Implement the COA algorithm for an example individual</span>
<span class='va'>coa_mat</span> <span class='op'>&lt;-</span> <span class='fu'>coa</span><span class='op'>(</span>mat <span class='op'>=</span> <span class='va'>detection_matrix_by_id</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, xy <span class='op'>=</span> <span class='va'>xy</span><span class='op'>)</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>coa_mat</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  num [1:255, 1:2] 709191 709276 709276 707542 705754 ...
#&gt;  - attr(*, "dimnames")=List of 2
#&gt;   ..$ : chr [1:255] "2016-03-17 00:00:00" "2016-03-21 00:00:00" "2016-03-22 00:00:00" "2016-03-23 00:00:00" ...
#&gt;   ..$ : chr [1:2] "x" "y"
#&gt;  - attr(*, "na.action")= 'omit' Named num [1:197] 1 2 3 4 5 6 7 8 9 10 ...
#&gt;   ..- attr(*, "names")= chr [1:197] "2016-03-07 00:00:00" "2016-03-08 00:00:00" "2016-03-09 00:00:00" "2016-03-10 00:00:00" ...</div><div class='input'>
<span class='co'>#### Example (2): Change the output format and coerce time stamps to POSIXct format</span>
<span class='va'>coa_dat</span> <span class='op'>&lt;-</span> <span class='fu'>coa</span><span class='op'>(</span>mat <span class='op'>=</span> <span class='va'>detection_matrix_by_id</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, xy <span class='op'>=</span> <span class='va'>xy</span>, output <span class='op'>=</span> <span class='st'>"data.frame"</span><span class='op'>)</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>coa_dat</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 'data.frame':	255 obs. of  3 variables:
#&gt;  $ timestamp: POSIXct, format: "2016-03-17 00:00:00" "2016-03-21 00:00:00" ...
#&gt;  $ x        : num  709191 709276 709276 707542 705754 ...
#&gt;  $ y        : num  6253067 6253117 6253117 6267727 6267071 ...</div><div class='input'>
<span class='co'>#### Example (3): Implement the algorithm on a cluster</span>
<span class='co'># This will only be faster for very large detection time series.</span>
<span class='kw'>if</span><span class='op'>(</span><span class='va'>flapper_run_parallel</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>coa_mat</span> <span class='op'>&lt;-</span> <span class='fu'>coa</span><span class='op'>(</span>mat <span class='op'>=</span> <span class='va'>detection_matrix_by_id</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>,
                 xy <span class='op'>=</span> <span class='va'>xy</span>,
                 cl <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></span><span class='op'>(</span><span class='fl'>2L</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


