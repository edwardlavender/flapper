<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Convert particle histories from pf into movement paths — pf_simplify • flapper</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Convert particle histories from pf into movement paths — pf_simplify"><meta property="og:description" content="This function is designed to simplify the pf_archive-class object from pf that defines sampled particle histories into a set of movement paths. The function identifies pairs of cells between which movement may have occurred at each time step (if necessary), (re)calculates distances and probabilities between connected cell pairs and then, if specified, links pairwise movements between cells into a set of possible movement paths."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/flapper_algorithms_faqs.html">`flapper`: practitioner FAQs</a>
    </li>
    <li>
      <a href="../articles/flapper_overview.html">`flapper`: an overview</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/edwardlavender/flapper/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert particle histories from <code><a href="pf.html">pf</a></code> into movement paths</h1>
    <small class="dont-index">Source: <a href="https://github.com/edwardlavender/flapper/blob/HEAD/R/pf_simplify.R" class="external-link"><code>R/pf_simplify.R</code></a></small>
    <div class="hidden name"><code>pf_simplify.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is designed to simplify the <code><a href="pf_archive-class.html">pf_archive-class</a></code> object from <code><a href="pf.html">pf</a></code> that defines sampled particle histories into a set of movement paths. The function identifies pairs of cells between which movement may have occurred at each time step (if necessary), (re)calculates distances and probabilities between connected cell pairs and then, if specified, links pairwise movements between cells into a set of possible movement paths.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pf_simplify</span><span class="op">(</span></span>
<span>  <span class="va">archive</span>,</span>
<span>  max_n_particles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_n_particles_sampler <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"weighted"</span>, <span class="st">"max"</span><span class="op">)</span>,</span>
<span>  bathy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance_lcp_fast <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance_graph <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance_limit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance_barrier <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance_barrier_limit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance_barrier_grid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calc_distance_restrict <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  calc_distance_algorithm <span class="op">=</span> <span class="st">"bi"</span>,</span>
<span>  calc_distance_constant <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  mobility <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mobility_from_origin <span class="op">=</span> <span class="va">mobility</span>,</span>
<span>  write_history <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  varlist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_all_cores <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path"</span>, <span class="st">"archive"</span><span class="op">)</span>,</span>
<span>  summarise_pr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  max_n_copies <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_n_copies_sampler <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"weighted"</span>, <span class="st">"max"</span><span class="op">)</span>,</span>
<span>  max_n_paths <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>  add_origin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>archive</dt>
<dd><p>A <code><a href="pf_archive-class.html">pf_archive-class</a></code> object from <code><a href="pf.html">pf</a></code>.</p></dd>


<dt>max_n_particles</dt>
<dd><p>(optional) An integer that defines the maximum number of particles to selected at each time step. If supplied, particle samples are thinned, with <code>max_n_particles</code> retained at each time step (in a method specified by <code>max_n_particles_sampler</code>), prior to processing. This reduces computation time but may lead to failures in path building (if the subset of sample particles cannot be connected into any movement paths).</p></dd>


<dt>max_n_particles_sampler</dt>
<dd><p>If <code>max_n_particles</code> is supplied, <code>max_n_particles_sampler</code> is a character that defines the sampling method. Currently supported options are: <code>"random"</code>, which implements random sampling; <code>"weighted"</code>, which implements weighted sampling, with random samples taken according to their probability at the current time step; and <code>"max"</code>, which selects the top <code>max_n_particles</code> most likely particles.</p></dd>


<dt>bathy</dt>
<dd><p>A <code><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></code> that defines the grid across the area within which the individual could have moved. <code>bathy</code> must be planar (i.e., Universal Transverse Mercator projection) with units of metres in x and y directions. If <code>calc_distance = "lcp"</code>, the surface's resolution is taken to define the distance between horizontally and vertically connected cells and must be the same in both x and y directions. Any cells with NA values (e.g., due to missing data) are treated as `impossible' to move though by the algorithm (see <code><a href="lcp_over_surface.html">lcp_over_surface</a></code>). If unsupplied, <code>bathy</code> can be extracted from <code>archive</code>, if available.</p></dd>


<dt>calc_distance</dt>
<dd><p>A character that defines the method used to calculate distances between sequential combinations of particles (see <code><a href="pf.html">pf</a></code>). Currently supported options are Euclidean distances (<code>"euclid"</code>) or shortest (least-cost) distances ("lcp"). In practice, Euclidean distances are calculated and then, for the subset of connections that meet specified criteria (see <code>calc_distance_limit</code>, <code>calc_distance_barrier</code>, <code>mobility_from_origin</code> and <code>mobility</code>), Euclidean distances are updated to shortest distances, if specified. Note that <code>calc_distance</code> does not need to be the same method as used for <code><a href="pf.html">pf</a></code>: it is often computationally beneficial to implement <code><a href="pf.html">pf</a></code> using Euclidean distances and then, for the subset of sampled particles, implement <code>pf_simplify</code> with <code>calc_distance = "lcp"</code> to re-compute distances using the shortest-distances algorithm, along with the adjusted probabilities. However, for large paths, the quickest option is to implement both functions using <code>calc_distance = "euclid"</code> and then interpolate shortest paths only for the set of returned paths (see <code><a href="lcp_interp.html">lcp_interp</a></code>). If <code>calc_distance = NULL</code>, the method saved in <code>archive</code> is used.</p></dd>


<dt>calc_distance_lcp_fast</dt>
<dd><p>(optional) If <code>calc_distance = "lcp"</code>, <code>calc_distance_lcp_fast</code> is a function that predicts the shortest distance. This function must accept two arguments (even if they are ignored): (a) a numeric vector of Euclidean distances and (b) an integer vector of barrier overlaps that defines whether (1) or not (1) each transect crosses a barrier (see <code><a href="lcp_comp.html">lcp_comp</a></code>). This option avoids the need to implement shortest-distance algorithms.</p></dd>


<dt>calc_distance_graph</dt>
<dd><p>(optional) If <code>calc_distance = "lcp"</code> and <code>calc_distance_lcp_fast = NULL</code>, <code>calc_distance_graph</code> is a graph object that defines the distances between connected cells in <code>bathy</code>. If unsupplied, this is taken from <code>archive$args$calc_distance_graph</code>, if available, or computed via <code><a href="lcp_graph_surface.html">lcp_graph_surface</a></code>.</p></dd>


<dt>calc_distance_limit</dt>
<dd><p>(optional) If <code>calc_distance = "lcp"</code> and <code>calc_distance_lcp_fast = NULL</code>, <code>calc_distance_limit</code> is a number that defines the lower Euclidean distance limit for shortest-distances calculations. If supplied, shortest distances are only calculated for cell connections that are more than a Euclidean distance of <code>calc_distance_limit</code> apart. In other words, if supplied, it is assumed that there exists a valid shortest path (shorter than the maximum distance imposed by the animal's mobility constraints) if the Euclidean distance between two points is less than <code>calc_distance_limit</code> (unless that segment crosses a barrier: see <code>calc_distance_barrier</code>). This option can improve the speed of distance calculations. However, if supplied, note that Euclidean and shortest distances (and resultant probabilities) may be mixed in function outputs. This argument is currently only implemented for <code><a href="pf_archive-class.html">pf_archive-class</a></code> objects derived with <code>calc_distance = "euclid"</code> and <code>calc_distance_euclid_fast = TRUE</code> via <code><a href="pf.html">pf</a></code> for which connected cell pairs need to be derived (i.e., not following a previous implementation of <code>pf_simplify</code>).</p></dd>


<dt>calc_distance_barrier</dt>
<dd><p>(optional) If <code>calc_distance = "lcp"</code>, <code>calc_distance_barrier</code> is a simple feature geometry that defines a barrier, such as the coastline, to movement (see <code><a href="segments_cross_barrier.html">segments_cross_barrier</a></code>). The coordinate reference system for this object must match <code>bathy</code>. If supplied, shortest distances are only calculated for segments that cross a barrier (or exceed <code>calc_distance_limit</code>). This option can improve the speed of distance calculations. However, if supplied, note that Euclidean and shortest distances (and resultant probabilities) may be mixed in function outputs. All <code>calc_distance_barrier*</code> arguments are currently only implemented for <code><a href="pf_archive-class.html">pf_archive-class</a></code> objects derived with <code>calc_distance = "euclid"</code> and <code>calc_distance_euclid_fast = TRUE</code> via <code><a href="pf.html">pf</a></code> for which connected cell pairs need to be derived (i.e., not following a previous implementation of <code>pf_simplify</code>).</p></dd>


<dt>calc_distance_barrier_limit</dt>
<dd><p>(optional) If <code>calc_distance_barrier</code> is supplied, <code>calc_distance_barrier_limit</code> is the lower Euclidean limit for determining barrier overlaps. If supplied, barrier overlaps are only determined for cell connections that are more than <code>calc_distance_barrier_limit</code> apart. This option can reduce the number of cell connections for which barrier overlaps need to be determined (and ultimately the speed of distance calculations).</p></dd>


<dt>calc_distance_barrier_grid</dt>
<dd><p>(optional) If <code>calc_distance_barrier</code> is supplied, <code>calc_distance_barrier_grid</code> is a <code><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></code> that defines the distance to the barrier (see <code><a href="segments_cross_barrier.html">segments_cross_barrier</a></code>). The coordinate reference system must match <code>bathy</code>. If supplied, <code>mobility_from_origin</code> and <code>mobility</code> are also required. <code>calc_distance_barrier_grid</code> is used to reduce the wall time of the barrier-overlap routine (see <code><a href="segments_cross_barrier.html">segments_cross_barrier</a></code>).</p></dd>


<dt>calc_distance_restrict</dt>
<dd><p>(optional) If and <code>calc_distance_lcp_fast = NULL</code> and <code>calc_distance_limit</code> and/or <code>calc_distance_barrier</code> are supplied, <code>calc_distance_restrict</code> is a logical variable that defines whether (<code>TRUE</code>) or not (<code>FALSE</code>) to restrict further the particle pairs for which shortest distances are calculated. If <code>TRUE</code>, the subset of particles flagged by <code>calc_distance_limit</code> and <code>calc_distance_barrier</code> for shortest-distance calculations is further restricted to consider only those pairs of particles for which there is not a valid connection to or from those particles under the Euclidean distance metric. Either way, there is no reduction in the set of particles, only in the number of connections evaluated between those particles. This can improve the speed of distance calculations.</p></dd>


<dt>calc_distance_algorithm, calc_distance_constant</dt>
<dd><p>Additional shortest-distance calculation options if <code>calc_distance_lcp_fast = NULL</code> (see <code><a href="https://rdrr.io/pkg/cppRouting/man/get_distance_pair.html" class="external-link">get_distance_pair</a></code>). <code>calc_distance_algorithm</code> is a character that defines the algorithm: <code>"Dijkstra"</code>, <code>"bi"</code>, <code>"A*"</code> or <code>"NBA"</code> are supported. <code>calc_distance_constant</code> is the numeric constant required to maintain the heuristic function admissible in the A* and NBA algorithms. For shortest distances (based on costs derived via <code><a href="lcp_costs.html">lcp_costs</a></code>), the default (<code>calc_distance_constant = 1</code>) is appropriate.</p></dd>


<dt>mobility, mobility_from_origin</dt>
<dd><p>(optional) The mobility parameters (see <code><a href="pf.html">pf</a></code>). If unsupplied, these can be extracted from <code>archive</code>, if available. However, even if <code><a href="pf.html">pf</a></code> was implemented without these options, it is beneficial to specify mobility limits here (especially if <code>calc_distance = "lcp"</code>) because they restrict the number of calculations that are required (for example, for shortest distances, at each time step, distances are only calculated for the subset of particle connections below <code>mobility_from_origin</code> or <code>mobility</code> in distance).</p></dd>


<dt>write_history</dt>
<dd><p>A named list of arguments, passed to <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></code>, to write `intermediate' files. The `file' argument should be the directory in which to write files. This argument is currently only implemented for <code><a href="pf_archive-class.html">pf_archive-class</a></code> objects derived with <code>calc_distance = TRUE</code> and <code>calc_distance_euclid_fast = TRUE</code> via <code><a href="pf.html">pf</a></code> for which connected cell pairs need to be derived (i.e., not following a previous implementation of <code>pf_simplify</code>). If supplied, two directories are created in `file' (1/ and 2/), in which dataframes of the pairwise distances between connected cells and the subset of those  that formed continuous paths from the start to the end of the time series are written, respectively. Files are named by time steps as `pf_1', `pf_2' and so on. Files for each time step are written and re-read from this directory during particle processing. This helps to minimise vector memory requirements because the information for all time steps does not have to be retained in memory at once.</p></dd>


<dt>cl, varlist, use_all_cores</dt>
<dd><p>(optional) Parallelisation options for the first stage of the algorithm, which identifies connected cell pairs, associated distances and movement probabilities. The first parallelisation option is to parallelise the algorithm over time steps via <code>cl</code>. <code>cl</code> is (a) a cluster object from <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></code> or (b) an integer that defines the number of child processes. If <code>cl</code> is supplied, <code>varlist</code> may be required. This is a character vector of variables for export (see <code><a href="cl.html">cl_export</a></code>). Exported variables must be located in the global environment. If a cluster is supplied, the connection to the cluster is closed within the function (see <code><a href="cl.html">cl_stop</a></code>). For further information, see <code><a href="cl.html">cl_lapply</a></code> and <code><a href="flapper-tips-parallel.html">flapper-tips-parallel</a></code>.The second parallelisation option is to parallelise shortest-distance calculations within time steps via a logical input (<code>TRUE</code>) to <code>use_all_cores</code> that is passed to <code><a href="https://rdrr.io/pkg/cppRouting/man/get_distance_matrix.html" class="external-link">get_distance_matrix</a></code>. This option is only implemented for <code>calc_distance = "lcp"</code>.</p></dd>


<dt>return</dt>
<dd><p>A character (<code>return = "path"</code> or <code>return = "archive"</code>) that defines the type of object that is returned (see Details).</p></dd>


<dt>summarise_pr</dt>
<dd><p>(optional) For <code>return = "archive"</code>, <code>summarise_pf</code> is a function or a logical input that defines whether or not (and how) to summarise the probabilities of duplicate cell records for each time step. If a function is supplied, only one record of each sampled cell is returned per time step, with the associated probability calculated from the probabilities of each sample of that cell using the supplied function. For example, <code>summarise_pr = max</code> returns the most probable sample. Alternatively, if a logical input (<code>summarise_pr = TRUE</code>) is supplied, only one record of each sampled cell is returned per time step, with the associated probability calculated as the sum of the normalised probabilities of all samples for that cell, rescaled so that the maximum probability takes a score of one. Specifying <code>summarise_pr</code> is useful for deriving maps of the `probability of use' across an area based on particle histories because it ensures that `probability of use' scores depend on the number of time steps during which an individual could have occupied a location, rather than the total number of samples of that location (see <code><a href="pf_plot_map.html">pf_plot_map</a></code>). Both <code>summarise_pr = NULL</code> and <code>summarise_pr = FALSE</code> suppress this argument.</p></dd>


<dt>max_n_copies</dt>
<dd><p>(optional) For <code>return = "path"</code>, <code>max_n_copies</code> is an integer that specifies the maximum number of copies of a sampled cell that are retained at each time stamp. Each copy represents a different route to that cell. By default, all copies (i.e. routes to that cell are retained) via <code>max_n_copies = NULL</code>. However, in cases where there are a large number of paths through a landscape, the function can run into vector memory limitations during path assembly, so <code>max_n_copies</code> may need to be set. In this case, at each time step, if there are more than <code>max_n_copies</code> paths to a given cell, then a subset of these (<code>max_n_copies</code>) are sampled, according to the <code>max_n_copies_sampler</code> argument.</p></dd>


<dt>max_n_copies_sampler</dt>
<dd><p>(optional) For <code>return = "path"</code>, if <code>max_n_copies</code> is supplied, <code>max_n_copies_sampler</code> is a character that defines the sampling method. Currently supported options are: <code>"random"</code>, which implements random sampling; <code>"weighted"</code>, which implements weighted sampling, with random samples taken according to their probability at the current time step; and <code>"max"</code>, which selects for the top <code>max_n_copies</code> most likely copies of a given cell according to the probability associated with movement into that cell from the previous location.</p></dd>


<dt>max_n_paths</dt>
<dd><p>(optional) For <code>return = "path"</code>, <code>max_n_paths</code> is an integer that specifies the maximum number of paths to be reconstructed. During path assembly, following the implementation of <code>max_n_copies</code> (if provided), <code>max_n_paths</code> are selected at random at each time step. This option is provided to improve the speed of path assembly in situations with large numbers of paths. <code>max_n_paths = NULL</code> computes all paths (if possible).</p></dd>


<dt>add_origin</dt>
<dd><p>For <code>return = "path"</code>, <code>add_origin</code> is a logical input that defines whether or not to include the origin in the returned dataframe.</p></dd>


<dt>verbose</dt>
<dd><p>A logical input that defines whether or not to print messages to the console to monitor function progress.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>If <code>return = "archive"</code>, the function returns a <code><a href="pf_archive-class.html">pf_archive-class</a></code> object, as inputted, but in which only the most likely record of each cell that was connected to cells at the next time step is retained and with the <code>method = "pf_simplify"</code> flag. If <code>return = "path"</code>, the function returns a <code><a href="pf_path-class.html">pf_path-class</a></code> object, which is a dataframe that defines the movement paths.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The implementation of this function depends on how <code><a href="pf.html">pf</a></code> has been implemented and the <code>return</code> argument. Under the default options in <code><a href="pf.html">pf</a></code>, the fast Euclidean distances method is used to sample sequential particle positions, in which case the history of each particle through the landscape is not retained and has to be assembled afterwards. In this case, <code>pf_simplify</code> calculates the distances between all combinations of cells at each time step, using either a Euclidean distances or shortest distances algorithm according to the input to <code>calc_distance</code>. Distances are converted to probabilities using the `intrinsic' probabilities associated with each location and the movement models retained in <code>archive</code> from the call to <code><a href="pf.html">pf</a></code> to identify possible movement paths between cells at each time step. If the fast Euclidean distances method has not been used, then pairwise cell movements are retained by <code><a href="pf.html">pf</a></code>. In this case, the function simply recalculates distances between sequential cell pairs and the associated cell probabilities, which are then processed according to the <code>return</code> argument.</p>
<p>Following the identification of pairwise cell movements, if <code>return = "archive"</code>, the function selects all of the unique cells at each time step that were connected to cells at the next time step. (For cells that were selected multiple times at a given time step, due to sampling with replacement in <code><a href="pf.html">pf</a></code>, if <code>summarise_pr</code> is supplied, only one sample is retained: in maps of the `probability of use' across an area (see <code><a href="pf_plot_map.html">pf_plot_map</a></code>), this ensures that cell scores depend on the number of time steps when the individual could have occupied a given cell, rather than the total number of samples of a location.) Otherwise, if <code>return = "path"</code>, pairwise cell movements are assembled into complete movement paths.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Edward Lavender</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#### Example particle histories</span></span></span>
<span class="r-in"><span><span class="co"># In these examples, we will use the example particle histories included in flapper</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dat_dcpf_histories</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Length Class  Mode     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> history 18     -none- list     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> method   1     -none- character</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> args    21     -none- list     </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (1): The default implementation</span></span></span>
<span class="r-in"><span><span class="va">paths_1</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:48)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:48) after ~0 minutes. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Demonstration that the distance and probabilities calculations are correct</span></span></span>
<span class="r-in"><span><span class="co"># The simple method below works if three conditions are met:</span></span></span>
<span class="r-in"><span><span class="co"># ... The 'intrinsic' probability associated with each cell is the same (as for DC algorithm);</span></span></span>
<span class="r-in"><span><span class="co"># ... Paths have been reconstructed via pf_simplify() using Euclidean distances;</span></span></span>
<span class="r-in"><span><span class="co"># ... The calc_movement_pr() movement model applies to all time steps;</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: magrittr</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘magrittr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:rlang’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     set_names</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">paths_1</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">paths_1</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">path_id</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    cell_xp <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cell_x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    cell_yp <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cell_y</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    cell_dist_chk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cell_xp</span> <span class="op">-</span> <span class="va">.data</span><span class="op">$</span><span class="va">cell_x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cell_yp</span> <span class="op">-</span> <span class="va">.data</span><span class="op">$</span><span class="va">cell_y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    cell_pr_chk <span class="op">=</span> <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="fu">calc_movement_pr</span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cell_dist_chk</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    dist_equal <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">cell_dist_chk</span> <span class="op">==</span> <span class="va">.data</span><span class="op">$</span><span class="va">cell_dist_chk</span>,</span></span>
<span class="r-in"><span>    pr_equal <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">cell_pr</span> <span class="op">==</span> <span class="va">.data</span><span class="op">$</span><span class="va">cell_pr_chk</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">paths_1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   path_id timestep cell_id   cell_x  cell_y   cell_z      cell_pr      dist</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       1        0    3241 708897.1 6254392 135.0958 1.000000e+00        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       1        1    3722 708922.1 6254242 134.0199 1.808832e-05 152.06906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       1        2    3243 708947.1 6254392 133.6996 1.663445e-05 152.06906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       1        3    3166 709022.1 6254416 133.6938 1.569277e-04  79.05694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       1        4    3006 709022.1 6254466 134.0630 1.826367e-04  50.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       1        5    3009 709097.1 6254466 134.9762 1.547789e-04  75.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    cell_xp cell_yp cell_dist_chk cell_pr_chk dist_equal pr_equal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       NA      NA            NA          NA         NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 708897.1 6254392     152.06906  0.06891651       TRUE    FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 708922.1 6254242     152.06906  0.06891651       TRUE    FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 708947.1 6254392      79.05694  0.74022781       TRUE    FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 709022.1 6254416      50.00000  0.92414182       TRUE    FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 709022.1 6254466      75.00000  0.77729986       TRUE    FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Demonstration that the depths of sampled cells are correct</span></span></span>
<span class="r-in"><span><span class="va">paths_1</span><span class="op">$</span><span class="va">cell_z_chk</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  <span class="va">paths_1</span><span class="op">$</span><span class="va">cell_id</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">paths_1</span><span class="op">$</span><span class="va">cell_z</span>, <span class="va">paths_1</span><span class="op">$</span><span class="va">cell_z_chk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compare depth time series</span></span></span>
<span class="r-in"><span><span class="co"># There is a relatively large degree of mismatch here, which reflects</span></span></span>
<span class="r-in"><span><span class="co"># ... the low resolution bathymetry data used for the algorithm.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pf_plot_1d.html">pf_plot_1d</a></span><span class="op">(</span><span class="va">paths_1</span>, <span class="va">dat_dc</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">archival</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pf_simplify-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Examine paths</span></span></span>
<span class="r-in"><span><span class="co"># Log likelihood</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pf_loglik.html">pf_loglik</a></span><span class="op">(</span><span class="va">paths_1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    path_id    loglik      delta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        4 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        5 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        3 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        2 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        1 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       19 -147.6582 1.88729381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7       24 -147.6644 1.89348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       18 -147.6736 1.90275861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9       23 -147.6798 1.90894575</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       9 -147.6820 1.91112531</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11      14 -147.6882 1.91731246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12       8 -147.6975 1.92659011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      13 -147.7037 1.93277725</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14      16 -147.7395 1.96864247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15      17 -147.7395 1.96864247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16      21 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17      22 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18       6 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19       7 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20      11 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21      12 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22      20 -151.9751 6.20417920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23      25 -151.9813 6.21036635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24      10 -151.9989 6.22801070</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25      15 -152.0051 6.23419785</span>
<span class="r-in"><span><span class="co"># 2-d visualisation</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pf_plot_2d.html">pf_plot_2d</a></span><span class="op">(</span><span class="va">paths_1</span>, <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  add_paths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> prettyGraphics::pretty_map() CRS taken as: 'NA'.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>zero-length arrow is of indeterminate angle and so skipped</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>zero-length arrow is of indeterminate angle and so skipped</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>zero-length arrow is of indeterminate angle and so skipped</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>zero-length arrow is of indeterminate angle and so skipped</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>zero-length arrow is of indeterminate angle and so skipped</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>zero-length arrow is of indeterminate angle and so skipped</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>zero-length arrow is of indeterminate angle and so skipped</span>
<span class="r-plt img"><img src="pf_simplify-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># 3-d visualisation</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pf_plot_3d.html">pf_plot_3d</a></span><span class="op">(</span><span class="va">paths_1</span>, <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Defining plot properties...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Producing plot...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (2): Re-calculate distances as shortest distances</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Implement flapper::pf()</span></span></span>
<span class="r-in"><span><span class="co"># For this example, we need to increase the number of particles</span></span></span>
<span class="r-in"><span><span class="co"># ... for Euclidean-based sampling to generate viable paths</span></span></span>
<span class="r-in"><span><span class="co"># ... when we consider shortest distances</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dcpf_args</span> <span class="op">&lt;-</span> <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span></span></span>
<span class="r-in"><span><span class="va">dcpf_args</span><span class="op">$</span><span class="va">calc_distance_euclid_fast</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="va">dcpf_args</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></span>
<span class="r-in"><span><span class="va">out_dcpf_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">pf</span>, <span class="va">dcpf_args</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf() called (@ 2023-08-29 15:45:48)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Setting up function... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Determining the set of possible starting locations (t = 1)... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Implementing algorithm iteratively over time steps... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 1... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 2... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 3... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 4... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 5... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 6... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 7... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 8... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 9... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 10... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 11... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 12... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 13... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 14... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 15... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 16... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 17... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 18... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf() call completed (@ 2023-08-29 15:45:49) after ~0.01 minutes. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Implement pf_simplify() using shortest distances</span></span></span>
<span class="r-in"><span><span class="va">paths_2</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_2</span>, calc_distance <span class="op">=</span> <span class="st">"lcp"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:49)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'lcp'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Setting up LCP calculations... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Setting up cost-surface for calc_distance = 'lcp'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_costs() called (@ 2023-08-29 15:45:49)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining transition matrices... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>transition function gives negative values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Calculating distance matrices... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling LCP costs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_costs() call completed (@ 2023-08-29 15:45:49) after ~0 minutes. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_graph_surface() called (@ 2023-08-29 15:45:49)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining nodes, edges and costs to make graph... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Constructing graph object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_graph_surface() call completed (@ 2023-08-29 15:45:49) after ~0 minutes. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:50) after ~0.01 minutes. </span>
<span class="r-in"><span><span class="co"># ... Duration: ~ 0.655 s</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_2</span>, calc_distance <span class="op">=</span> <span class="st">"lcp"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>transition function gives negative values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.490   0.039   0.636 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Demonstrate the LCP calculations are correct</span></span></span>
<span class="r-in"><span><span class="va">paths_2_lcps</span> <span class="op">&lt;-</span> <span class="fu"><a href="lcp_interp.html">lcp_interp</a></span><span class="op">(</span><span class="va">paths_2</span>,</span></span>
<span class="r-in"><span>  <span class="va">out_dcpf_2</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  calc_distance <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_interp() called (@ 2023-08-29 15:45:51)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Setting up function... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Processing paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Calculating least-cost paths via flapper::lcp_over_surface()... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_over_surface() called (@ 2023-08-29 15:45:51)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Checking user inputs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining cost matrix... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>transition function gives negative values</span>
<span class="r-plt img"><img src="pf_simplify-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Using method = 'cppRouting'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Defining nodes, edges and costs to make graph... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Constructing graph object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Implementing bi algorithm to compute least-cost paths(s)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_over_surface() call completed (@ 2023-08-29 15:45:52) after ~0.01 minutes. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Summarising distances for each least-cost path... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_interp() call completed (@ 2023-08-29 15:45:52) after ~0.01 minutes. </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">paths_2</span><span class="op">$</span><span class="va">dist</span>, <span class="va">paths_2_lcps</span><span class="op">$</span><span class="va">dist_lcp</span><span class="op">$</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]        NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  60.38712   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  60.38712   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]  60.37633   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 156.07347   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 135.35917   NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Trial options for increasing speed of shortest-distance calculations</span></span></span>
<span class="r-in"><span><span class="co"># Speed up shortest-distance calculations via (a) the graph:</span></span></span>
<span class="r-in"><span><span class="co"># ... Duration: ~0.495 s</span></span></span>
<span class="r-in"><span><span class="co"># ... Note that you may achieve further speed improvements via</span></span></span>
<span class="r-in"><span><span class="co"># ... a simplified/contracted graph</span></span></span>
<span class="r-in"><span><span class="co"># ... ... see cppRouting::cpp_simplify()</span></span></span>
<span class="r-in"><span><span class="co"># ... ... see cppRouting::cpp_contract()</span></span></span>
<span class="r-in"><span><span class="va">costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="lcp_costs.html">lcp_costs</a></span><span class="op">(</span><span class="va">out_dcpf_2</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_costs() called (@ 2023-08-29 15:45:52)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining transition matrices... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>transition function gives negative values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Calculating distance matrices... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling LCP costs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_costs() call completed (@ 2023-08-29 15:45:52) after ~0 minutes. </span>
<span class="r-in"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="lcp_graph_surface.html">lcp_graph_surface</a></span><span class="op">(</span><span class="va">out_dcpf_2</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span>, <span class="va">costs</span><span class="op">$</span><span class="va">dist_total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_graph_surface() called (@ 2023-08-29 15:45:52)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining nodes, edges and costs to make graph... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Constructing graph object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_graph_surface() call completed (@ 2023-08-29 15:45:52) after ~0 minutes. </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_2</span>,</span></span>
<span class="r-in"><span>      calc_distance <span class="op">=</span> <span class="st">"lcp"</span>,</span></span>
<span class="r-in"><span>      calc_distance_graph <span class="op">=</span> <span class="va">graph</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.329   0.023   0.296 </span>
<span class="r-in"><span><span class="co"># Speed up shortest-distance calculations via (b) the lower Euclid dist limit</span></span></span>
<span class="r-in"><span><span class="co"># ... Duration: ~0.493 s</span></span></span>
<span class="r-in"><span><span class="va">costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="lcp_costs.html">lcp_costs</a></span><span class="op">(</span><span class="va">out_dcpf_2</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_costs() called (@ 2023-08-29 15:45:53)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining transition matrices... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>transition function gives negative values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Calculating distance matrices... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling LCP costs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_costs() call completed (@ 2023-08-29 15:45:53) after ~0 minutes. </span>
<span class="r-in"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="lcp_graph_surface.html">lcp_graph_surface</a></span><span class="op">(</span><span class="va">out_dcpf_2</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span>, <span class="va">costs</span><span class="op">$</span><span class="va">dist_total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::lcp_graph_surface() called (@ 2023-08-29 15:45:53)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Defining nodes, edges and costs to make graph... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Constructing graph object... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::lcp_graph_surface() call completed (@ 2023-08-29 15:45:53) after ~0 minutes. </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_2</span>,</span></span>
<span class="r-in"><span>      calc_distance <span class="op">=</span> <span class="st">"lcp"</span>,</span></span>
<span class="r-in"><span>      calc_distance_graph <span class="op">=</span> <span class="va">graph</span>,</span></span>
<span class="r-in"><span>      calc_distance_limit <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.308   0.020   0.268 </span>
<span class="r-in"><span><span class="co"># Speed up shortest-distance calculations via (c) the barrier</span></span></span>
<span class="r-in"><span><span class="co"># ... Duration: ~1.411 s (much slower in this example)</span></span></span>
<span class="r-in"><span><span class="va">coastline</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">dat_coast</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">coastline</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_2</span>,</span></span>
<span class="r-in"><span>      calc_distance <span class="op">=</span> <span class="st">"lcp"</span>,</span></span>
<span class="r-in"><span>      calc_distance_graph <span class="op">=</span> <span class="va">graph</span>,</span></span>
<span class="r-in"><span>      calc_distance_limit <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>      calc_distance_barrier <span class="op">=</span> <span class="va">coastline</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The CRSs of 'bathy' and 'calc_distance_barrier' are not identical.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -- details: Modes: S4, characterAttributes: &lt; Modes: list, NULL &gt;Attributes: &lt; Lengths: 2, 0 &gt;Attributes: &lt; names for target but not for current &gt;Attributes: &lt; current is not list-like &gt;.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -- bathy CRS: 'NA'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -- calc_distance_barrier CRS: ''.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.409   0.033   0.390 </span>
<span class="r-in"><span><span class="co"># Speed up calculations via (d) mobility limits</span></span></span>
<span class="r-in"><span><span class="co"># ... (In the examples above, the mobility parameters</span></span></span>
<span class="r-in"><span><span class="co"># ... can be extracted from out_dcpf_2,</span></span></span>
<span class="r-in"><span><span class="co"># ... so specifying them directly here in this example makes</span></span></span>
<span class="r-in"><span><span class="co"># ... no material difference, but this is not necessarily the case</span></span></span>
<span class="r-in"><span><span class="co"># ... if pf() has been implemented without mobility parameters).</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_2</span>,</span></span>
<span class="r-in"><span>      calc_distance <span class="op">=</span> <span class="st">"lcp"</span>,</span></span>
<span class="r-in"><span>      calc_distance_graph <span class="op">=</span> <span class="va">graph</span>,</span></span>
<span class="r-in"><span>      calc_distance_limit <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>      mobility <span class="op">=</span> <span class="fl">200</span>,</span></span>
<span class="r-in"><span>      mobility_from_origin <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.308   0.027   0.395 </span>
<span class="r-in"><span><span class="co"># Speed up calculations via (e) parallelisation</span></span></span>
<span class="r-in"><span><span class="co"># ... see the details in the documentation.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (3): Restrict the number of routes to each cell at each time step</span></span></span>
<span class="r-in"><span><span class="co"># Implement approach for different numbers of copies</span></span></span>
<span class="r-in"><span><span class="co"># Since we only have sampled a small number of particles for this simulation</span></span></span>
<span class="r-in"><span><span class="co"># ... this does not make any difference here, but it can dramatically reduce</span></span></span>
<span class="r-in"><span><span class="co"># ... the time taken to assemble paths and prevent vector memory issues.</span></span></span>
<span class="r-in"><span><span class="va">paths_3a</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>, max_n_copies <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:55)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:55) after ~0 minutes. </span>
<span class="r-in"><span><span class="va">paths_3b</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>, max_n_copies <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:55)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:55) after ~0 minutes. </span>
<span class="r-in"><span><span class="va">paths_3c</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>, max_n_copies <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:55)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:56) after ~0 minutes. </span>
<span class="r-in"><span><span class="co"># Compare the number of paths retained</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paths_3a</span><span class="op">$</span><span class="va">path_id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  3  4  5  6  7  8  9 10</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paths_3b</span><span class="op">$</span><span class="va">path_id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paths_3c</span><span class="op">$</span><span class="va">path_id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (4): Change the sampling method used to retain paths</span></span></span>
<span class="r-in"><span><span class="co"># Again, this doesn't make a difference here, but it can when there are</span></span></span>
<span class="r-in"><span><span class="co"># ... more particles.</span></span></span>
<span class="r-in"><span><span class="va">paths_4a</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>,</span></span>
<span class="r-in"><span>  max_n_copies <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  max_n_copies_sampler <span class="op">=</span> <span class="st">"random"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:56)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:56) after ~0 minutes. </span>
<span class="r-in"><span><span class="va">paths_4b</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>,</span></span>
<span class="r-in"><span>  max_n_copies <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  max_n_copies_sampler <span class="op">=</span> <span class="st">"weighted"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:56)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:56) after ~0 minutes. </span>
<span class="r-in"><span><span class="va">paths_4c</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>,</span></span>
<span class="r-in"><span>  max_n_copies <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  max_n_copies_sampler <span class="op">=</span> <span class="st">"max"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:56)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:57) after ~0.01 minutes. </span>
<span class="r-in"><span><span class="co"># Compare retained paths</span></span></span>
<span class="r-in"><span><span class="fu"><a href="pf_loglik.html">pf_loglik</a></span><span class="op">(</span><span class="va">paths_3a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    path_id    loglik      delta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        3 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        4 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        5 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        2 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        7 -147.6820 1.91112531</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        8 -147.6975 1.92659011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        6 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        9 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10      10 -151.9989 6.22801070</span>
<span class="r-in"><span><span class="fu"><a href="pf_loglik.html">pf_loglik</a></span><span class="op">(</span><span class="va">paths_3b</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    path_id    loglik      delta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        2 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        3 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        4 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        5 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       11 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7       12 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       13 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9       14 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10      15 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11      16 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12      17 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      18 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14      19 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15      20 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16      21 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17      22 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18      23 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19      24 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20      25 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21       6 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22       7 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23       8 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24       9 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25      10 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26      31 -147.6582 1.88729381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27      34 -147.6582 1.88729381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28      37 -147.6736 1.90275861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29      38 -147.6736 1.90275861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30      39 -147.6736 1.90275861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31      40 -147.6736 1.90275861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32      32 -147.6882 1.91731246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33      33 -147.6882 1.91731246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34      35 -147.6882 1.91731246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35      36 -147.7037 1.93277725</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36      27 -147.7395 1.96864247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37      28 -147.7395 1.96864247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38      42 -147.7395 1.96864247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39      43 -147.7395 1.96864247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40      26 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41      29 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42      30 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43      41 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44      44 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45      45 -147.7695 1.99866112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 46      46 -151.9751 6.20417920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 47      47 -151.9751 6.20417920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 48      49 -151.9751 6.20417920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49      48 -152.0051 6.23419785</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50      50 -152.0051 6.23419785</span>
<span class="r-in"><span><span class="fu"><a href="pf_loglik.html">pf_loglik</a></span><span class="op">(</span><span class="va">paths_3c</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    path_id    loglik      delta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        2 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        3 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        4 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        5 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        6 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        7 -145.7709 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       15 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9       16 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10      17 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11      18 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12      19 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      20 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14      21 -145.8111 0.04017947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15      22 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16      23 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17      24 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18      25 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19      26 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20      27 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21      28 -145.8431 0.07217439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22      29 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23      30 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24      31 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25      32 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26      33 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27      34 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28      35 -145.9346 0.16376265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29       8 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30       9 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31      10 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32      11 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33      12 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34      13 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35      14 -146.8934 1.12246741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36      43 -147.6644 1.89348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37      44 -147.6644 1.89348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38      45 -147.6644 1.89348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39      47 -147.6644 1.89348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40      48 -147.6644 1.89348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41      49 -147.6644 1.89348096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42      51 -147.6798 1.90894575</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43      55 -147.6798 1.90894575</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44      56 -147.6798 1.90894575</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45      46 -147.6820 1.91112531</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 46      50 -147.6975 1.92659011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 47      52 -147.6975 1.92659011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 48      53 -147.6975 1.92659011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49      54 -147.6975 1.92659011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50      36 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 51      38 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 52      39 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 53      42 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 54      58 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 55      60 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 56      62 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 57      63 -147.7457 1.97482962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 58      37 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59      40 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 60      41 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 61      57 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 62      59 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 63      61 -147.7634 1.99247397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 64      64 -151.9813 6.21036635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65      66 -151.9813 6.21036635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 66      67 -151.9813 6.21036635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 67      69 -151.9813 6.21036635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 68      70 -151.9813 6.21036635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 69      65 -151.9989 6.22801070</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 70      68 -151.9989 6.22801070</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (5): Set the maximum number of paths for reconstruction (for speed)</span></span></span>
<span class="r-in"><span><span class="co"># Reconstruct all paths (note you may experience vector memory limitations)</span></span></span>
<span class="r-in"><span><span class="co"># unique(pf_simplify(dat_dcpf_histories, max_n_paths = NULL)$path_id)</span></span></span>
<span class="r-in"><span><span class="co"># Reconstruct one path</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>, max_n_paths <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">path_id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:57)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:57) after ~0 minutes. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="co"># Reconstruct (at most) five paths</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>, max_n_paths <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">path_id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:57)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:57) after ~0 minutes. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 3 4 5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (6): Retain/drop the origin, if specified</span></span></span>
<span class="r-in"><span><span class="co"># For the example particle histories, an origin was specified</span></span></span>
<span class="r-in"><span><span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">origin</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]    [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 708886.3 6254404</span>
<span class="r-in"><span><span class="co"># This is included as 'timestep = 0' in the returned dataframe</span></span></span>
<span class="r-in"><span><span class="co"># ... with the coordinates re-defined on bathy:</span></span></span>
<span class="r-in"><span><span class="va">paths_5a</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:57)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:57) after ~0 minutes. </span>
<span class="r-in"><span><span class="va">paths_5a</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cell_x"</span>, <span class="st">"cell_y"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cell_x  cell_y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 708897.1 6254392</span>
<span class="r-in"><span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/xyCellFrom.html" class="external-link">xyFromCell</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/xyCellFrom.html" class="external-link">cellFromXY</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>    <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span><span class="op">$</span><span class="va">origin</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             x       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 708897.1 6254392</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">paths_5a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   path_id timestep cell_id   cell_x  cell_y   cell_z      cell_pr      dist</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       1        0    3241 708897.1 6254392 135.0958 1.000000e+00        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       1        1    3722 708922.1 6254242 134.0199 1.808832e-05 152.06906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       1        2    3243 708947.1 6254392 133.6996 1.663445e-05 152.06906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       1        3    3166 709022.1 6254416 133.6938 1.569277e-04  79.05694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       1        4    3006 709022.1 6254466 134.0630 1.826367e-04  50.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       1        5    3009 709097.1 6254466 134.9762 1.547789e-04  75.00000</span>
<span class="r-in"><span><span class="co"># If specified, the origin is dropped with add_origin = FALSE</span></span></span>
<span class="r-in"><span><span class="va">paths_5b</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">dat_dcpf_histories</span>, add_origin <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:45:57)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:45:57) after ~0 minutes. </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">paths_5b</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   path_id timestep cell_id   cell_x  cell_y   cell_z      cell_pr      dist</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       1        1    3722 708922.1 6254242 134.0199 1.808832e-05 152.06906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       1        2    3243 708947.1 6254392 133.6996 1.663445e-05 152.06906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       1        3    3166 709022.1 6254416 133.6938 1.569277e-04  79.05694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       1        4    3006 709022.1 6254466 134.0630 1.826367e-04  50.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       1        5    3009 709097.1 6254466 134.9762 1.547789e-04  75.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       1        6    3329 709097.1 6254366 135.3115 1.049538e-04 100.00000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example (6) Get particle samples for connected particles</span></span></span>
<span class="r-in"><span><span class="co">## Implement DCPF with more particles for demonstration purposes</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dcpf_args</span> <span class="op">&lt;-</span> <span class="va">dat_dcpf_histories</span><span class="op">$</span><span class="va">args</span></span></span>
<span class="r-in"><span><span class="va">dcpf_args</span><span class="op">$</span><span class="va">calc_distance_euclid_fast</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="va">dcpf_args</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">250</span></span></span>
<span class="r-in"><span><span class="va">out_dcpf_6a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">pf</span>, <span class="va">dcpf_args</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf() called (@ 2023-08-29 15:45:57)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Setting up function... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Determining the set of possible starting locations (t = 1)... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Implementing algorithm iteratively over time steps... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 1... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 2... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 3... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 4... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 5... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 6... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 7... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 8... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 9... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 10... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 11... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 12... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 13... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 14... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 15... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 16... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 17... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... For each particle, getting the possible positions for the next time step... </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>GEOS support is provided by the sf and terra packages among others</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Time = 18... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... ... Selecting candidate starting positions for the current time step... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf() call completed (@ 2023-08-29 15:46:01) after ~0.06 minutes. </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_dcpf_6a</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id_current   pr_current timestep</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       3243 2.425569e-04        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       2921 1.312336e-04        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       3396 3.947544e-05        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       3159 2.364016e-04        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       3320 2.525012e-04        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       3237 1.312336e-04        1</span>
<span class="r-in"><span><span class="co">## Extract particle samples for connected particles</span></span></span>
<span class="r-in"><span><span class="co"># There may be multiple records of any given cell at any given time step</span></span></span>
<span class="r-in"><span><span class="co"># ... due to sampling with replacement.</span></span></span>
<span class="r-in"><span><span class="va">out_dcpf_6b</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_6a</span>, return <span class="op">=</span> <span class="st">"archive"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:46:01)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Getting pairwise cell movements based on calc_distance = 'euclid'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Stepping through time steps to join coordinate pairs... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Identifying connected cells... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Processing connected cells for return = 'archive'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:46:01) after ~0 minutes. </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_dcpf_6b</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timestep id_previous id_current dist_current   pr_current</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1        3241       2838     145.7738 2.416378e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        1        3241       2839     134.6291 3.947544e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        1        3241       2841     125.0000 5.845148e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        1        3241       2842     127.4755 5.302119e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        1        3241       2917     141.4214 2.938080e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        1        3241       2918     125.0000 5.845148e-05</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">out_dcpf_6b</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">id_current</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    90 </span>
<span class="r-in"><span><span class="co">## Extract particle samples for connected particles,</span></span></span>
<span class="r-in"><span><span class="co"># ... with only the most likely record of each particle returned.</span></span></span>
<span class="r-in"><span><span class="co"># We can implement the approach using out_dcpf_6b</span></span></span>
<span class="r-in"><span><span class="co"># ... to skip distance calculations.</span></span></span>
<span class="r-in"><span><span class="co"># Now, there is only one (the most likely) record of sampled cells</span></span></span>
<span class="r-in"><span><span class="co"># ... at each time step.</span></span></span>
<span class="r-in"><span><span class="va">out_dcpf_6c</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_6b</span>,</span></span>
<span class="r-in"><span>  summarise_pr <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  return <span class="op">=</span> <span class="st">"archive"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:46:01)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... ... Processing connected cells for return = 'archive'... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:46:01) after ~0.01 minutes. </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_dcpf_6c</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timestep id_previous id_current dist_current  pr_current</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1        3241       2838     145.7738 0.002078627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        1        3241       2839     134.6291 0.003395774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        1        3241       2841     125.0000 0.005028139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        1        3241       2842     127.4755 0.004561012</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        1        3241       2917     141.4214 0.002527408</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        1        3241       2918     125.0000 0.005028139</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">out_dcpf_6c</span><span class="op">$</span><span class="va">history</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">id_current</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    90 </span>
<span class="r-in"><span><span class="co">## Make movement paths</span></span></span>
<span class="r-in"><span><span class="co"># Again, we use out_dcpf_6b to skip distance calculations.</span></span></span>
<span class="r-in"><span><span class="va">out_dcpf_6d</span> <span class="op">&lt;-</span> <span class="fu">pf_simplify</span><span class="op">(</span><span class="va">out_dcpf_6b</span>,</span></span>
<span class="r-in"><span>  max_n_copies <span class="op">=</span> <span class="fl">2L</span>,</span></span>
<span class="r-in"><span>  return <span class="op">=</span> <span class="st">"path"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> flapper::pf_simplify() called (@ 2023-08-29 15:46:01)... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Assembling paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Formatting paths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... Adding cell coordinates and depths... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ... flapper::pf_simplify() call completed (@ 2023-08-29 15:46:05) after ~0.07 minutes. </span>
<span class="r-in"><span><span class="co">## Compare resultant maps</span></span></span>
<span class="r-in"><span><span class="co"># The map for all particles is influenced by particles that were 'dead ends',</span></span></span>
<span class="r-in"><span><span class="co"># ... which isn't ideal for a map of space use.</span></span></span>
<span class="r-in"><span><span class="co"># The map for connected samples deals with this problem, but is influenced by</span></span></span>
<span class="r-in"><span><span class="co"># ... the total number of samples of each cell, rather than the number of time steps</span></span></span>
<span class="r-in"><span><span class="co"># ... in which the individual could have been located in a given cell.</span></span></span>
<span class="r-in"><span><span class="co"># The map for unique, connected samples deals with this issue, so that scores</span></span></span>
<span class="r-in"><span><span class="co"># ... represent the number of time steps in which the individual could have occupied</span></span></span>
<span class="r-in"><span><span class="co"># ... a given cell, over the length of the time series.</span></span></span>
<span class="r-in"><span><span class="co"># The map for the paths are sparser because paths have only been reconstructed</span></span></span>
<span class="r-in"><span><span class="co"># ... for a sample of sampled particles.</span></span></span>
<span class="r-in"><span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, oma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">paa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, axis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span><span class="va">m_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_plot_map.html">pf_plot_map</a></span><span class="op">(</span><span class="va">out_dcpf_6a</span>, <span class="va">dcpf_args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  transform <span class="op">=</span> <span class="va">transform</span>,</span></span>
<span class="r-in"><span>  pretty_axis_args <span class="op">=</span> <span class="va">paa</span>, main <span class="op">=</span> <span class="st">"all samples"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[1]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[2]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[3]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[4]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[5]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[6]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[7]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[8]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[9]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[10]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[11]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[12]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[13]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[14]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[15]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[16]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[17]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[18]] contains duplicate cells. Implementing pf_simplify() with 'summarise_pr = TRUE' and return = 'archive' specified first is advised.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> prettyGraphics::pretty_map() CRS taken as: 'NA'.</span>
<span class="r-in"><span><span class="va">m_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_plot_map.html">pf_plot_map</a></span><span class="op">(</span><span class="va">out_dcpf_6b</span>, <span class="va">dcpf_args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  transform <span class="op">=</span> <span class="va">transform</span>,</span></span>
<span class="r-in"><span>  pretty_axis_args <span class="op">=</span> <span class="va">paa</span>, main <span class="op">=</span> <span class="st">"connected samples"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[2]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[3]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[4]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[5]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[6]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[7]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[8]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[9]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[10]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[11]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[12]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[13]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[14]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[15]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[16]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[17]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>xpf$history[[18]] contains duplicate cells. Did you implement pf_simplify() without 'summarise_pr = TRUE'?</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> prettyGraphics::pretty_map() CRS taken as: 'NA'.</span>
<span class="r-in"><span><span class="va">m_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_plot_map.html">pf_plot_map</a></span><span class="op">(</span><span class="va">out_dcpf_6c</span>, <span class="va">dcpf_args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  transform <span class="op">=</span> <span class="va">transform</span>,</span></span>
<span class="r-in"><span>  pretty_axis_args <span class="op">=</span> <span class="va">paa</span>, main <span class="op">=</span> <span class="st">"unique, connected samples"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> prettyGraphics::pretty_map() CRS taken as: 'NA'.</span>
<span class="r-in"><span><span class="va">m_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="pf_plot_map.html">pf_plot_map</a></span><span class="op">(</span><span class="va">out_dcpf_6d</span>, <span class="va">dcpf_args</span><span class="op">$</span><span class="va">bathy</span>,</span></span>
<span class="r-in"><span>  transform <span class="op">=</span> <span class="va">transform</span>,</span></span>
<span class="r-in"><span>  pretty_axis_args <span class="op">=</span> <span class="va">paa</span>, main <span class="op">=</span> <span class="st">"paths"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> prettyGraphics::pretty_map() CRS taken as: 'NA'.</span>
<span class="r-plt img"><img src="pf_simplify-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Note that all locations in reconstructed paths are derived from PF samples</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">out_dcpf_6d</span><span class="op">$</span><span class="va">cell_id</span><span class="op">[</span><span class="va">out_dcpf_6d</span><span class="op">$</span><span class="va">timestep</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">out_dcpf_6c</span><span class="op">$</span><span class="va">history</span><span class="op">)</span><span class="op">$</span><span class="va">id_current</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># But the paths only contain a subset of sampled particles</span></span></span>
<span class="r-in"><span><span class="va">h_6a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">out_dcpf_6a</span><span class="op">$</span><span class="va">history</span>, <span class="kw">function</span><span class="op">(</span><span class="va">elm</span><span class="op">)</span> <span class="va">elm</span><span class="op">[</span>, <span class="st">"id_current"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">h_6a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">out_dcpf_6d</span><span class="op">$</span><span class="va">cell_id</span><span class="op">[</span><span class="va">out_dcpf_6d</span><span class="op">$</span><span class="va">timestep</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE  TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1608   333 </span>
<span class="r-in"><span><span class="va">h_6b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">out_dcpf_6b</span><span class="op">$</span><span class="va">history</span>, <span class="kw">function</span><span class="op">(</span><span class="va">elm</span><span class="op">)</span> <span class="va">elm</span><span class="op">[</span>, <span class="st">"id_current"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">h_6b</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">out_dcpf_6d</span><span class="op">$</span><span class="va">cell_id</span><span class="op">[</span><span class="va">out_dcpf_6d</span><span class="op">$</span><span class="va">timestep</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE  TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1291   333 </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

