<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Intermediate wrapper for .acs that supports parallelisation — .acs_pl • flapper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Intermediate wrapper for .acs that supports parallelisation — .acs_pl" />
<meta property="og:description" content="This function implements the acoustic-container (AC) and acoustic-container depth-contour (ACDC) algorithms. This is called via a front-end function (i.e. ac or acdc). It checks and processes inputs and implements the selected algorithm via calls to .acs. Outputs are returned in a named list." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/edwardlavender/flapper/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Intermediate wrapper for <code><a href='.acs.html'>.acs</a></code> that supports parallelisation</h1>
    <small class="dont-index">Source: <a href='https://github.com/edwardlavender/flapper/blob/master/R/acs_pl_backend.R'><code>R/acs_pl_backend.R</code></a></small>
    <div class="hidden name"><code>dot-acs_pl.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function implements the acoustic-container (AC) and acoustic-container depth-contour (ACDC) algorithms. This is called via a front-end function (i.e. <code><a href='ac.html'>ac</a></code> or <code><a href='acdc.html'>acdc</a></code>). It checks and processes inputs and implements the selected algorithm via calls to <code><a href='.acs.html'>.acs</a></code>. Outputs are returned in a named list.</p>
    </div>

    <pre class="usage"><span class='fu'>.acs_pl</span><span class='op'>(</span>
  <span class='va'>acoustics</span>,
  archival <span class='op'>=</span> <span class='cn'>NULL</span>,
  step <span class='op'>=</span> <span class='fl'>120</span>,
  plot_ts <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>bathy</span>,
  <span class='va'>detection_containers</span>,
  detection_kernels <span class='op'>=</span> <span class='cn'>NULL</span>,
  detection_kernels_overlap <span class='op'>=</span> <span class='cn'>NULL</span>,
  detection_time_window <span class='op'>=</span> <span class='fl'>5</span>,
  <span class='va'>mobility</span>,
  calc_depth_error <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2.5</span>, <span class='fl'>2.5</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
  normalise <span class='op'>=</span> <span class='cn'>TRUE</span>,
  save_record_spatial <span class='op'>=</span> <span class='fl'>1L</span>,
  write_record_spatial_for_pf <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  con <span class='op'>=</span> <span class='st'>""</span>,
  progress <span class='op'>=</span> <span class='fl'>1L</span>,
  split <span class='op'>=</span> <span class='cn'>NULL</span>,
  cl <span class='op'>=</span> <span class='cn'>NULL</span>,
  varlist <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>acoustics</th>
      <td><p>A dataframe, or a list of dataframes, that contains passive acoustic telemetry detection time series (see <code><a href='dat_acoustics.html'>dat_acoustics</a></code> for an example) for a single individual. Each dataframe should contain the following columns: an integer vector of receiver IDs, named `receiver_id'; an integer vector of detection indices, named `index'; and a POSIXct vector of time stamps when detections were made, named `timestamp'. If a list of dataframes is supplied, dataframes must be refer to the detections of a single individual and be ordered by time (e.g., in hourly chunks). In addition, sequential list elements must be linked by identical receiver pairs (i.e., the final receiver at which the individual was detected for any given chunk must be the same as the receiver at which the individual was next detected at the start of the next chunk) because it is only in this specific scenario that information does not need to be shared across time steps (see <code>split</code>). The algorithm will be implemented on each dataframe, termed `chunk', either in sequence or parallel. Any empty or <code>NULL</code> elements will be removed automatically.</p></td>
    </tr>
    <tr>
      <th>archival</th>
      <td><p>For the ACDC algorithm, <code>archival</code> is a dataframe that contains depth time series (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>step</th>
      <td><p>A number that defines the time step length (s) between consecutive detections (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>plot_ts</th>
      <td><p>A logical input that defines whether or not to plot movement time series (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>bathy</th>
      <td><p>A <code><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></code> that defines the area (for the AC algorithm) or bathymetry (for the ACDC algorithm) across the area within which the individual could have moved (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>detection_containers</th>
      <td><p>A list of detection containers (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>detection_kernels</th>
      <td><p>A named list of detection probability kernels (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>detection_kernels_overlap</th>
      <td><p>A named list of detection probability kernel overlaps, directly from <code><a href='get_detection_containers_overlap.html'>get_detection_containers_overlap</a></code>. This must contain an element named `list_by_receiver' with the data for each receiver.</p></td>
    </tr>
    <tr>
      <th>detection_time_window</th>
      <td><p>A number that defines the detection time window (see <code><a href='.acs.html'>.acs</a></code>)</p></td>
    </tr>
    <tr>
      <th>mobility</th>
      <td><p>The mobility parameter (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>calc_depth_error</th>
      <td><p>The depth error function (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>normalise</th>
      <td><p>A logical input that defines whether or not to normalise maps (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>save_record_spatial</th>
      <td><p>An integer of the spatial layers to save (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>write_record_spatial_for_pf</th>
      <td><p>A named list used to write time step-specific maps to file (see <code><a href='.acs.html'>.acs</a></code>).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>A logical variable that defines whether or not to print messages to the console or to file to relay function progress. If <code>con = ""</code>, messages are printed to the console (which is only supported if the algorithm is not implemented in parallel: see below); otherwise, they are written to file (see below).</p></td>
    </tr>
    <tr>
      <th>con</th>
      <td><p>If <code>verbose = TRUE</code>, <code>con</code> is character string defines how messages relaying function progress are returned. If <code>con = ""</code>, messages are printed to the console (unless redirected by <code><a href='https://rdrr.io/r/base/sink.html'>sink</a></code>), an approach that is only implemented if the function is not implemented in parallel. Otherwise, <code>con</code> defines the directory into which to write .txt files, into which messages are written to relay function progress. This approach, rather than printing to the console, is recommended for clarity, speed and debugging. If the algorithm is implemented step-wise, then a single file is written to the specified directory named acdc_log.txt. If the algorithm is implemented chunk-wise, then an additional file is written for each chunk (named dot_acdc_log_1.txt, dot_acdc_log_2.txt and so on), with the details for each chunk.</p></td>
    </tr>
    <tr>
      <th>progress</th>
      <td><p>(optional) If the algorithm is implemented step-wise, <code>progress</code> is an integer (<code>1</code>, <code>2</code> or <code>3</code>) that defines whether or not to display a progress bar in the console as the algorithm moves over acoustic time steps (<code>1</code>), the `archival' time steps between each pair of acoustic detections (<code>2</code>) or both acoustic and archival time steps (<code>3</code>), in which case the overall acoustic progress bar is punctuated by an archival progress bar for each pair of acoustic detections. This option is useful if there is a large number of archival observations between acoustic detections. Any other input will suppress the progress bar. If the algorithm is implemented for chunks, inputs to <code>progress</code> are ignored and a single progress bar is shown of the progress across acoustic chunks.</p></td>
    </tr>
    <tr>
      <th>split</th>
      <td><p>A character string that defines the (approximate) time unit used to split acoustic time series into chunks (e.g., <code>"12 hours"</code>). If provided, this must be supported by <code><a href='https://rdrr.io/r/base/cut.POSIXt.html'>cut.POSIXt</a></code> (otherwise, a pre-defined list of acoustic time series can be passed to <code>acoustics</code>, e.g., specifying seasonal chunks). If <code>split = NULL</code> and a cluster has been specified (see <code>cl</code>) (and <code>acoustics</code> is a dataframe), then the acoustic time series is automatically split into chunks and the algorithm implemented for each chunk in parallel. In all cases, splitting is subject to the constraint that  chunks must join at identical receiver pairs (i.e., the last receiver at which the individual was detected on one chunk must match the first receiver at which the individual was next detected at the start of the next chunk): in these specific scenarios, information does not need to transfer from one time step to the next.</p></td>
    </tr>
    <tr>
      <th>cl, varlist</th>
      <td><p>(optional) Parallelisation options. <code>cl</code> is (a) a cluster object from <code><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></code> or (b) an integer that defines the number of child processes to implement the algorithm in parallel. If supplied, the algorithm is implemented for each chunk in a list of acoustic time series, either (a) as supplied by the user (if <code>acoustics</code> is a list), (b) as defined by the input to <code>split</code>, or (c) as defined automatically from the number of nodes in the cluster if <code>split = NULL</code>. If <code>cl</code> is supplied, <code>varlist</code> may also be required. This is a character vector of objects to export (see <code><a href='cl.html'>cl_export</a></code>). Exported variables must be located in the global environment. If a cluster is supplied, the connection to the cluster is closed within the function (see <code><a href='cl.html'>cl_stop</a></code>). For further information, see <code><a href='cl.html'>cl_lapply</a></code> and <code><a href='flapper-tips-parallel.html'>flapper-tips-parallel</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns an <code><a href='acdc_archive-class.html'>acdc_archive-class</a></code> object. If a connection to write files has also been specified, an overall log (acdc_log.txt) as well as chunk-specific logs from calls to <code><a href='.acs.html'>.acs</a></code>, if applicable, are written to file.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>The front-end functions <code><a href='ac.html'>ac</a></code> and <code><a href='acdc.html'>acdc</a></code> call this function, which in turn calls <code><a href='.acs.html'>.acs</a></code>. <code><a href='acs_setup_containers.html'>acs_setup_containers</a></code> defines the detection containers required by this function. <code><a href='acs_setup_mobility.html'>acs_setup_mobility</a></code> is used to examine the assumption of the constant `mobility' parameter. <code><a href='acs_setup_detection_kernels.html'>acs_setup_detection_kernels</a></code> produces detection probability kernels for incorporation into the function. For calls via <code><a href='ac.html'>ac</a></code> and <code><a href='acdc.html'>acdc</a></code>, <code><a href='acdc_simplify.html'>acdc_simplify</a></code> simplifies the outputs and <code><a href='acdc_plot_trace.html'>acdc_plot_trace</a></code>, <code><a href='acdc_plot_record.html'>acdc_plot_record</a></code> and <code><a href='acdc_animate_record.html'>acdc_animate_record</a></code> visualise the results.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Edward Lavender</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># For examples, see ?ac and ?acdc which call this function directly.</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


