<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Parallelisation in flapper — flapper-tips-parallel • flapper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Parallelisation in flapper — flapper-tips-parallel" />
<meta property="og:description" content="Parallelisation in the base R installation (since v. 2.14.0) can be implemented via the parallel package. This is an amalgamation of two earlier packages (snow and multicore) that extends the apply family of functions with parallelisation. (Beyond the apply family, other packages further develop parallelisation, such as foreach, which integrates parallelisation into the familiar for loop.)
Of particular interest in flapper are the two parallelised versions of lapply provided by parallel: parLapply and mclapply. These functions implement parallelisation in two distinct ways.
parLapply implements parallelisation via socket clusters*, which essentially involves launching an additional R process on each core on which code is executed. This approach is initiated by the definition of a cluster object with makeCluster. Since each R process is unique, objects defined in the `main' workspace that are required by the parallelised code have to be exported to each core (see clusterEvalQ and clusterExport) before that code is executed. During code execution, each R process occupies memory. At the end of the code, the cluster needs to be closed (see stopCluster).
In contrast, mclapply implements parallelisation using fork clusters. Rather than launching an additional R process on each core, this approach clones the existing `parent' workspace on each core. Both `parent' and `child' processes refer to the same address in the system's memory. This simplifies implementation and reduces overhead costs: in mclapply, the number of cores (or `child processes') is simply specified and everything else is taken care of. On POSIX systems, such as MacOS, this approach can be faster than the socket approach and is typically preferable. However, error messages may be less informative (see Examples). Forking is not available on Windows.
In the flapper package, parallelisation is implemented using pblapply, which is a convenient wrapper for the parLapply and mclapply functions, via a cl argument. If cl is a cluster object, a character vector of objects required for export can also be supplied via varlist. If supplied, flapper functions will call clusterExport before pblapply. The latter is then called and parallelisation is implemented via parLapply. Following code execution, flapper functions close the cluster. In contrast, if cl is an integer, flapper functions pass this directly to pblapply and parallelisation is implemented via mclapply.
Despite potential benefits, the overhead costs associated with parallelisation can be substantial. To minimise overheads, some flapper functions can implement parallelisation over `chunks', within which serial iteration via lapply is implemented. For calls to pblapply, there is an additional overhead associated with the progress bar, which can be suppressed via pbapply::pboptions(type = &quot;none&quot;). Given overhead costs, in some situations, parallelisation may be undesirable. For computationally intensive functions in flapper that support parallelisation, such as ac, dc, acdc and pf_simplify, time trials of alternative approaches using subsets of the data are strongly recommenced.
In the future, parallelisation routines in flapper may be improved to reduce memory requirements and expanded beyond `perfectly parallel' problems (in which each iteration is entirely independent) to other situations.
*Forking can be implemented via makeCluster for  parLapply but it is usually preferable to call mclapply directly (e.g., as in pblapply)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/edwardlavender/flapper/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Parallelisation in <code><a href='flapper.html'>flapper</a></code></h1>
    <small class="dont-index">Source: <a href='https://github.com/edwardlavender/flapper/blob/master/R/flapper-tips.R'><code>R/flapper-tips.R</code></a></small>
    <div class="hidden name"><code>flapper-tips-parallel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Parallelisation in the base R installation (since v. 2.14.0) can be implemented via the <code><a href='https://rdrr.io/r/parallel/parallel-package.html'>parallel</a></code> package. This is an amalgamation of two earlier packages (<code>snow</code> and <code>multicore</code>) that extends the <code>apply</code> family of functions with parallelisation. (Beyond the <code>apply</code> family, other packages further develop parallelisation, such as <code>foreach</code>, which integrates parallelisation into the familiar <code>for</code> loop.)</p>
<p>Of particular interest in <code><a href='flapper.html'>flapper</a></code> are the two parallelised versions of <code><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></code> provided by <code><a href='https://rdrr.io/r/parallel/parallel-package.html'>parallel</a></code>: <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>parLapply</a></code> and <code><a href='https://rdrr.io/r/parallel/mclapply.html'>mclapply</a></code>. These functions implement parallelisation in two distinct ways.</p>
<p><code><a href='https://rdrr.io/r/parallel/clusterApply.html'>parLapply</a></code> implements parallelisation via socket clusters*, which essentially involves launching an additional R process on each core on which code is executed. This approach is initiated by the definition of a cluster object with <code><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></code>. Since each R process is unique, objects defined in the `main' workspace that are required by the parallelised code have to be exported to each core (see <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>clusterEvalQ</a></code> and <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>clusterExport</a></code>) before that code is executed. During code execution, each R process occupies memory. At the end of the code, the cluster needs to be closed (see <code><a href='https://rdrr.io/r/parallel/makeCluster.html'>stopCluster</a></code>).</p>
<p>In contrast, <code><a href='https://rdrr.io/r/parallel/mclapply.html'>mclapply</a></code> implements parallelisation using fork clusters. Rather than launching an additional R process on each core, this approach clones the existing `parent' workspace on each core. Both `parent' and `child' processes refer to the same address in the system's memory. This simplifies implementation and reduces overhead costs: in <code><a href='https://rdrr.io/r/parallel/mclapply.html'>mclapply</a></code>, the number of cores (or `child processes') is simply specified and everything else is taken care of. On POSIX systems, such as MacOS, this approach can be faster than the socket approach and is typically preferable. However, error messages may be less informative (see Examples). Forking is not available on Windows.</p>
<p>In the <code><a href='flapper.html'>flapper</a></code> package, parallelisation is implemented using <code><a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pblapply</a></code>, which is a convenient wrapper for the <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>parLapply</a></code> and <code><a href='https://rdrr.io/r/parallel/mclapply.html'>mclapply</a></code> functions, via a <code>cl</code> argument. If <code>cl</code> is a cluster object, a character vector of objects required for export can also be supplied via <code>varlist</code>. If supplied, <code><a href='flapper.html'>flapper</a></code> functions will call <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>clusterExport</a></code> before <code><a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pblapply</a></code>. The latter is then called and parallelisation is implemented via <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>parLapply</a></code>. Following code execution, <code><a href='flapper.html'>flapper</a></code> functions close the cluster. In contrast, if <code>cl</code> is an integer, <code><a href='flapper.html'>flapper</a></code> functions pass this directly to <code><a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pblapply</a></code> and parallelisation is implemented via <code><a href='https://rdrr.io/r/parallel/mclapply.html'>mclapply</a></code>.</p>
<p>Despite potential benefits, the overhead costs associated with parallelisation can be substantial. To minimise overheads, some <code><a href='flapper.html'>flapper</a></code> functions can implement parallelisation over `chunks', within which serial iteration via <code><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></code> is implemented. For calls to <code><a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pblapply</a></code>, there is an additional overhead associated with the progress bar, which can be suppressed via <code><a href='https://rdrr.io/pkg/pbapply/man/pboptions.html'>pbapply::pboptions(type = "none")</a></code>. Given overhead costs, in some situations, parallelisation may be undesirable. For computationally intensive functions in <code><a href='flapper.html'>flapper</a></code> that support parallelisation, such as <code><a href='ac.html'>ac</a></code>, <code><a href='dc.html'>dc</a></code>, <code><a href='acdc.html'>acdc</a></code> and <code><a href='pf_simplify.html'>pf_simplify</a></code>, time trials of alternative approaches using subsets of the data are strongly recommenced.</p>
<p>In the future, parallelisation routines in <code><a href='flapper.html'>flapper</a></code> may be improved to reduce memory requirements and expanded beyond `perfectly parallel' problems (in which each iteration is entirely independent) to other situations.</p>
<p>*Forking can be implemented via <code><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></code> for  <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>parLapply</a></code> but it is usually preferable to call <code><a href='https://rdrr.io/r/parallel/mclapply.html'>mclapply</a></code> directly (e.g., as in <code><a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pblapply</a></code>).</p>
    </div>



    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Errickson, J. Parallel Processing in R. https://dept.stat.lsa.umich.edu/~jerrick/courses/stat701/notes/parallel.html. Accessed 29 November 2021.</p>
<p>Hallquist, M. (2018). Parallel computing in R. https://psu-psychology.github.io/r-bootcamp-2018/talks/parallel_r.html. Accessed 29 November 2021.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Edward Lavender</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span><span class='op'>(</span><span class='va'>flapper_run_slow</span><span class='op'>)</span><span class='op'>{</span>

  <span class='co'>#### Background</span>
  <span class='co'># In this example, we explore, for a small time series</span>
  <span class='co'># ... of particles created via pf(), the speed of alternative</span>
  <span class='co'># ... particle processing routines without/with parallelisation</span>
  <span class='co'># ... and with sockets versus forking.</span>

  <span class='co'>#### Implement pf() for example data using a large number of particles</span>
  <span class='va'>pf_args</span>   <span class='op'>&lt;-</span> <span class='va'>dat_dcpf_histories</span><span class='op'>$</span><span class='va'>args</span>
  <span class='va'>pf_args</span><span class='op'>$</span><span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>200L</span>
  <span class='va'>pf_args</span><span class='op'>$</span><span class='va'>calc_distance_euclid_fast</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>
  <span class='va'>out_pf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='va'>pf</span>, <span class='va'>pf_args</span><span class='op'>)</span>

  <span class='co'>#### Compare the speed of alternative parallelisation approaches</span>
  <span class='co'># ... for particle processing</span>
  <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"rbenchmark"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
    <span class='va'>pb_op</span> <span class='op'>&lt;-</span> <span class='fu'>pbapply</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pbapply/man/pboptions.html'>pboptions</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
    <span class='fu'>rbenchmark</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rbenchmark/man/benchmark.html'>benchmark</a></span><span class='op'>(</span>
      baseline <span class='op'>=</span> <span class='fu'><a href='pf_simplify.html'>pf_simplify</a></span><span class='op'>(</span><span class='va'>out_pf</span>,
                             cl <span class='op'>=</span> <span class='cn'>NULL</span>,
                             calc_distance <span class='op'>=</span> <span class='st'>"lcp"</span>,
                             verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
      fork <span class='op'>=</span> <span class='fu'><a href='pf_simplify.html'>pf_simplify</a></span><span class='op'>(</span><span class='va'>out_pf</span>,
                         cl <span class='op'>=</span> <span class='fl'>2L</span>,
                         calc_distance <span class='op'>=</span> <span class='st'>"lcp"</span>,
                         verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
      socket <span class='op'>=</span> <span class='fu'><a href='pf_simplify.html'>pf_simplify</a></span><span class='op'>(</span><span class='va'>out_pf</span>, calc_distance <span class='op'>=</span> <span class='st'>"lcp"</span>,
                           cl <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></span><span class='op'>(</span><span class='fl'>2L</span><span class='op'>)</span>,
                           verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
      replications <span class='op'>=</span> <span class='fl'>1L</span>
    <span class='op'>)</span>
    <span class='fu'>pbapply</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pbapply/man/pboptions.html'>pboptions</a></span><span class='op'>(</span><span class='va'>pb_op</span><span class='op'>)</span>
  <span class='op'>}</span>

<span class='op'>}</span>
</div><div class='output co'>#&gt; flapper::pf() called (@ 2022-05-28 18:09:13)... 
#&gt; ... Setting up function... 
#&gt; ... Determining the set of possible starting locations (t = 1)... 
#&gt; ... Implementing algorithm iteratively over time steps... 
#&gt; ... ... Time = 1... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 2... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 3... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 4... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 5... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 6... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 7... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 8... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 9... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 10... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 11... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 12... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 13... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 14... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 15... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 16... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 17... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... ... ... For each particle, getting the possible positions for the next time step... 
#&gt; ... ... Time = 18... 
#&gt; ... ... ... Selecting candidate starting positions for the current time step... 
#&gt; ... flapper::pf() call completed (@ 2022-05-28 18:09:20) after ~0.11 minutes. </div><div class='output co'>#&gt; <span class='warning'>Warning: transition function gives negative values</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='warning'>Warning: transition function gives negative values</span></div><div class='output co'>#&gt; <span class='warning'>Warning: transition function gives negative values</span></div><div class='output co'>#&gt; <span class='warning'>Warning: transition function gives negative values</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='message'>Running bidirectional Dijkstra...</span></div><div class='output co'>#&gt; <span class='warning'>Warning: transition function gives negative values</span></div><div class='output co'>#&gt; <span class='warning'>Warning: transition function gives negative values</span></div><div class='input'>
<span class='co'>#### Note a difference in error handling between socket clusters and forking:</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Implement pf() with a small number of particles</span>
<span class='va'>pf_args</span>   <span class='op'>&lt;-</span> <span class='va'>dat_dcpf_histories</span><span class='op'>$</span><span class='va'>args</span>
<span class='va'>pf_args</span><span class='op'>$</span><span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>10L</span>
<span class='va'>pf_args</span><span class='op'>$</span><span class='va'>calc_distance_euclid_fast</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>
<span class='va'>out_pf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='va'>pf</span>, <span class='va'>pf_args</span><span class='op'>)</span>
<span class='co'># With a socket cluster, we get an informative error message that there are no</span>
<span class='co'># ... particles that obey shortest-distance constraints</span>
<span class='co'># ... (which is because we have implemented pf() using Euclidean sampling</span>
<span class='co'># ... with only 10 particles).</span>
<span class='fu'><a href='pf_simplify.html'>pf_simplify</a></span><span class='op'>(</span><span class='va'>out_pf</span>,
            calc_distance <span class='op'>=</span> <span class='st'>"lcp"</span>,
            cl <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></span><span class='op'>(</span><span class='fl'>2L</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># With forking, we get an apparently less helpful error message:</span>
<span class='fu'><a href='pf_simplify.html'>pf_simplify</a></span><span class='op'>(</span><span class='va'>out_pf</span>,
            calc_distance <span class='op'>=</span> <span class='st'>"lcp"</span>,
            cl <span class='op'>=</span> <span class='fl'>2L</span><span class='op'>)</span>
<span class='co'># This results from a difference in error handling</span>
<span class='co'># ... between parLapply() and mclapply(), as shown here:</span>
<span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>pbapply</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pblapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, cl <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></span><span class='op'>(</span><span class='fl'>2L</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span><span class='op'>{</span>
  <span class='kw'>if</span><span class='op'>(</span><span class='va'>i</span><span class='op'>==</span> <span class='fl'>5L</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"error"</span><span class='op'>)</span> <span class='kw'>else</span> <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
<span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>pbapply</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pblapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, cl <span class='op'>=</span> <span class='fl'>2L</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span><span class='op'>{</span>
  <span class='kw'>if</span><span class='op'>(</span><span class='va'>i</span><span class='op'>==</span> <span class='fl'>5L</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"error"</span><span class='op'>)</span> <span class='kw'>else</span> <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
<span class='co'># In the example above, connected cells are being identified at each time step</span>
<span class='co'># ... based on previous cells. The function hits a point at which there are no</span>
<span class='co'># ... allowed cells, and returns an error, but mclapply() handles this with</span>
<span class='co'># ... tryCatch and attempts to continue the filtration process on the next time step.</span>
<span class='co'># ... The filter operation then fails because it expects a dataframe, not a character</span>
<span class='co'># ... (error message).</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


