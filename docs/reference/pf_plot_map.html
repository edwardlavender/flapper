<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Plot `probability of use' from a PF algorithm — pf_plot_map • flapper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Plot `probability of use' from a PF algorithm — pf_plot_map" />
<meta property="og:description" content="This function creates a raster of the `probability of use' across an area based on (a) particles sampled or (b) paths reconstructed by a particle filtering (PF) algorithm. To implement the function, an (a) pf_archive-class object that contains connected particles (locations) sampled by pf and processed by pf_simplify or (b) pf_path-class object that contains reconstructed paths must be supplied. The function extracts sampled locations and, for each location, calculates `the probability of use' for that location over the time series (see Details). This is (optionally) plotted and returned (invisibly) as a raster." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/edwardlavender/flapper/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plot `probability of use' from a PF algorithm</h1>
    <small class="dont-index">Source: <a href='https://github.com/edwardlavender/flapper/blob/master/R/pf_analyse_either.R'><code>R/pf_analyse_either.R</code></a></small>
    <div class="hidden name"><code>pf_plot_map.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function creates a <code><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></code> of the `probability of use' across an area based on (a) particles sampled or (b) paths reconstructed by a particle filtering (PF) algorithm. To implement the function, an (a) <code><a href='pf_archive-class.html'>pf_archive-class</a></code> object that contains connected particles (locations) sampled by <code><a href='pf.html'>pf</a></code> and processed by <code><a href='pf_simplify.html'>pf_simplify</a></code> or (b) <code><a href='pf_path-class.html'>pf_path-class</a></code> object that contains reconstructed paths must be supplied. The function extracts sampled locations and, for each location, calculates `the probability of use' for that location over the time series (see Details). This is (optionally) plotted and returned (invisibly) as a <code><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>pf_plot_map</span><span class='op'>(</span>
  <span class='va'>xpf</span>,
  <span class='va'>map</span>,
  transform <span class='op'>=</span> <span class='cn'>NULL</span>,
  scale <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"original"</span>, <span class='st'>"max"</span>, <span class='st'>"sum"</span><span class='op'>)</span>,
  plot <span class='op'>=</span> <span class='cn'>TRUE</span>,
  add_rasters <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>xpf</th>
      <td><p>A <code><a href='pf_archive-class.html'>pf_archive-class</a></code> object (from <code><a href='pf.html'>pf</a></code> plus <code><a href='pf_simplify.html'>pf_simplify</a></code> with <code>return = "archive"</code>) or a <code><a href='pf_path-class.html'>pf_path-class</a></code> object (from <code><a href='pf.html'>pf</a></code> plus <code><a href='pf_simplify.html'>pf_simplify</a></code> with <code>return = "path"</code>).</p></td>
    </tr>
    <tr>
      <th>map</th>
      <td><p>A <code><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></code> that defines a grid across the area of interest.</p></td>
    </tr>
    <tr>
      <th>transform</th>
      <td><p>(optional) A function to transform cell weights (e.g, <code><a href='https://rdrr.io/r/base/Log.html'>log</a></code>).</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>A character that defines how <code><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></code> values are scaled: <code>"original"</code> uses the original values; <code>"max"</code> scales values by the maximum value (so that, if <code>transform = NULL</code>, they lie between zero and one; and <code>"sum"</code> scales values by their sum so that they sum to one.</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>A logical input that defines whether or not to plot the map.</p></td>
    </tr>
    <tr>
      <th>add_rasters</th>
      <td><p>If <code>plot = TRUE</code>, <code>add_rasters</code> is a named list, passed to <code><a href='https://edwardlavender.github.io/prettyGraphics/reference/pretty_map.html'>pretty_map</a></code>, to customise the appearance of the plotted surface.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='https://edwardlavender.github.io/prettyGraphics/reference/pretty_map.html'>pretty_map</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function invisibly returns a <code><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></code>, in which each cell contains the `probability of use' score  and (optionally) produces a plot of this surface.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For particle-based implementations, this function is designed to be implemented for the subset of sampled particles that formed continuous paths from the start to the end of the time series (see <code><a href='pf_simplify.html'>pf_simplify</a></code>). At each time step, only one record of each location (derived by summarising the probabilities of multiple samples of the same location with the <code>summarise_pf</code> argument in <code><a href='pf_simplify.html'>pf_simplify</a></code>) should be passed to <code>pf_plot_map</code> to ensure that cell scores depend on the number of time steps when the individual could have occupied a given cell, rather than the total number of samples of a location. For each location, the 'probability of use' is calculated as the sum of the number of times (time steps) that the location was sampled, weighted by the associated probabilities of each sample, over the total number of time steps. The benefit of this approach is that all particles that were part of paths from the start to the end of the time series are incorporated in the resultant map. However, this comes at the cost of simplifying cell probabilities for duplicate records and ignoring variation in the overall likelihood of different movement paths.</p>
<p>For path-based implementations, the function is designed to be implemented for paths reconstructed by <code><a href='pf_simplify.html'>pf_simplify</a></code>. For each path, as for particle-based implementations, for each location, the 'probability of use' is calculated as the sum of the number of times (time steps) that the location was sampled, weighted by the associated probabilities of each sample, over the total number of time steps. (This is equivalent to calculating a weighted sum of the paths). Scores are then averaged across paths. This benefit of this approach is that it is possible to account for both location probabilities (in the weighted summation) and path probabilities (in the averaging of cell scores across paths, although this is not yet implemented). However, this approach can usually only be implemented for a subset of all possible paths (see <code>max_n_copies</code> in <code><a href='pf_simplify.html'>pf_simplify</a></code>) and these paths may not be independent (they may share substantial sections).</p>
<p>For either implementation, raw scores can be transformed or scaled to facilitate comparisons.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='pf.html'>pf</a></code> implements PF. <code><a href='pf_simplify.html'>pf_simplify</a></code> assembles paths from particle histories. <code><a href='pf_plot_history.html'>pf_plot_history</a></code> visualises particle histories. <code><a href='pf_plot_1d.html'>pf_plot_1d</a></code>, <code><a href='pf_plot_2d.html'>pf_plot_2d</a></code> and <code><a href='pf_plot_3d.html'>pf_plot_3d</a></code> provide plotting routines for paths. <code><a href='pf_loglik.html'>pf_loglik</a></code> calculates the log-probability of each path.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Edward Lavender</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#### Prepare data</span>
<span class='co'>## Particle-based implementation</span>
<span class='co'># The example data 'dat_dcpf_histories' contains all particles sampled</span>
<span class='co'># ... by an implementation of the DCPF algorithm. However, not all particles</span>
<span class='co'># ... that were sampled at one time step may have been near to particles sampled</span>
<span class='co'># ... at the next time step. In addition, some particles may have been sampled</span>
<span class='co'># ... multiple times at one time step, but our maps of space use should reflect</span>
<span class='co'># ... the number of time steps that the individual could have occupied a location,</span>
<span class='co'># ... rather than the total number of samples of a location. Hence, to map</span>
<span class='co'># ... space use, we should focus on the subset of particles that were connected</span>
<span class='co'># ... between time steps and only retain one record of each particle at each time step</span>
<span class='co'># ... using pf_simplify() with return = "archive"</span>
<span class='va'>dat_dcpf_histories_connected</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='pf_simplify.html'>pf_simplify</a></span><span class='op'>(</span><span class='va'>dat_dcpf_histories</span>,
             summarise_pr <span class='op'>=</span> <span class='cn'>TRUE</span>,
             return <span class='op'>=</span> <span class='st'>"archive"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::pf_simplify() called (@ 2022-06-17 10:07:47)... 
#&gt; ... Getting pairwise cell movements based on calc_distance = 'euclid'... 
#&gt; ... ... Stepping through time steps to join coordinate pairs... 
#&gt; ... ... Identifying connected cells... 
#&gt; ... ... Processing connected cells for return = 'archive'... 
#&gt; ... flapper::pf_simplify() call completed (@ 2022-06-17 10:07:48) after ~0 minutes. </div><div class='input'><span class='co'>## Path based implementation</span>
<span class='co'># The example data 'dat_dcpf_paths' contains a sample of paths reconstructed</span>
<span class='co'># ... by the DCPF algorithm and we can also implement the function for these paths.</span>

<span class='co'>#### Example (1): Implement the function with default options</span>
<span class='va'>pp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_histories_connected</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='input'><span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_paths</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='img'><img src='pf_plot_map-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span><span class='va'>pp</span><span class='op'>)</span>

<span class='co'>#### Example (2): Re-scale the map(s)</span>
<span class='va'>pp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_histories_connected</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span>, scale <span class='op'>=</span> <span class='st'>"max"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='input'><span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_histories_connected</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span>, scale <span class='op'>=</span> <span class='st'>"sum"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='input'><span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_paths</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span>, scale <span class='op'>=</span> <span class='st'>"max"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='input'><span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_paths</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span>, scale <span class='op'>=</span> <span class='st'>"sum"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='img'><img src='pf_plot_map-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span><span class='va'>pp</span><span class='op'>)</span>

<span class='co'>#### Example (3): Customise the map(s)</span>
<span class='va'>pp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_histories_connected</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span>,
            add_rasters <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>col <span class='op'>=</span> <span class='fu'>grDevices</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grDevices/gray.colors.html'>grey.colors</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>,
            xlab <span class='op'>=</span> <span class='st'>"x"</span>, ylab <span class='op'>=</span> <span class='st'>"y"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='input'><span class='fu'>pf_plot_map</span><span class='op'>(</span><span class='va'>dat_dcpf_paths</span>, map <span class='op'>=</span> <span class='va'>dat_dc</span><span class='op'>$</span><span class='va'>args</span><span class='op'>$</span><span class='va'>bathy</span>,
            add_rasters <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>col <span class='op'>=</span> <span class='fu'>grDevices</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>topo.colors</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>,
            xlab <span class='op'>=</span> <span class='st'>"x"</span>, ylab <span class='op'>=</span> <span class='st'>"y"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: 'NA'.</span></div><div class='img'><img src='pf_plot_map-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span><span class='va'>pp</span><span class='op'>)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


