<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Assemble counts of transmissions/detections from sentinel tags — assemble_sentinel_counts • flapper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Assemble counts of transmissions/detections from sentinel tags — assemble_sentinel_counts" />
<meta property="og:description" content="This function assembles a dataframe of counts of transmissions/detections from sentinel tags over user-defined time windows. For each sentinel tag, in each time window, the function counts the number of transmissions of that tag (i.e., the expected number of detections at nearby receivers). At the same time, the function determines the number of detections at all nearby receivers (defined as those within a user-specified distance) that were active at the same time as the sentinel tag. The result is a dataframe which comprises, for each tag and each time window, the number of transmissions (i.e., the expected number of detections) and the observed number of detections at each nearby receiver, arranged in long format." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/edwardlavender/flapper/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Assemble counts of transmissions/detections from sentinel tags</h1>
    <small class="dont-index">Source: <a href='https://github.com/edwardlavender/flapper/blob/master/R/assembles.R'><code>R/assembles.R</code></a></small>
    <div class="hidden name"><code>assemble_sentinel_counts.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function assembles a dataframe of counts of transmissions/detections from sentinel tags over user-defined time windows. For each sentinel tag, in each time window, the function counts the number of transmissions of that tag (i.e., the expected number of detections at nearby receivers). At the same time, the function determines the number of detections at all nearby receivers (defined as those within a user-specified distance) that were active at the same time as the sentinel tag. The result is a dataframe which comprises, for each tag and each time window, the number of transmissions (i.e., the expected number of detections) and the observed number of detections at each nearby receiver, arranged in long format.</p>
    </div>

    <pre class="usage"><span class='fu'>assemble_sentinel_counts</span><span class='op'>(</span>
  <span class='va'>sentinel</span>,
  <span class='va'>moorings</span>,
  breaks <span class='op'>=</span> <span class='st'>"hours"</span>,
  as_POSIXct <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>tz</span> <span class='op'>=</span> <span class='st'>"UTC"</span>, <span class='va'>...</span><span class='op'>)</span> <span class='fu'>fasttime</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/fasttime/man/fastPOSIXct.html'>fastPOSIXct</a></span><span class='op'>(</span><span class='va'>x</span>, tz <span class='op'>=</span> <span class='va'>tz</span>, <span class='va'>...</span><span class='op'>)</span>,
  detection_range <span class='op'>=</span> <span class='fl'>2000</span>,
  dist_btw_receivers <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sentinel</th>
      <td><p>A dataframe that includes all sentinel tag transmissions and detections. This should include the following columns: `timestamp', the time of each observation; `type', the type of each observation ("transmission" or "detection"); `sink_id', a unique identifier of the receivers which received the transmissions; and `source_id', a unique identifier of the receivers from which the transmission was released (by the built-in sentinel tag). (When the `source_id' is the same as the `sink_id', the observation is of type "transmission"; otherwise, the observation must be of type "detection"). See <code><a href='dat_sentinel.html'>dat_sentinel</a></code> for an example.</p></td>
    </tr>
    <tr>
      <th>moorings</th>
      <td><p>A dataframe that includes receiver identifiers, deployment times and locations. This information is necessary so that, for each time window, only receivers that could have detected transmissions (i.e., were nearby to the transmitter and active at the time of transmission) are included in the processed dataframe. This should include the following columns: `receiver_id', a unique identifier for each receiver; `receiver_start_date', the deployment date for each receiver; `receiver_end_date', the deployment end date for each receiver; `receiver_long', the receiver longitude (decimal degrees); and `receiver_lat', the receiver latitude (decimal degrees). See <code><a href='dat_moorings.html'>dat_moorings</a></code> for an example.</p></td>
    </tr>
    <tr>
      <th>breaks</th>
      <td><p>The time interval over which transmissions/detections are counted (e.g. <code>"hours"</code>). This is passed to the <code>breaks</code> argument of <code><a href='https://rdrr.io/r/base/cut.POSIXt.html'>cut.POSIXt</a></code>.</p></td>
    </tr>
    <tr>
      <th>as_POSIXct</th>
      <td><p>A function that defines how to convert character time bins (returned by <code><a href='https://rdrr.io/r/base/cut.POSIXt.html'>cut.POSIXt</a></code>) to POSIXct format. Usually, <code><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></code> is suitable but, for large time series, this is slow. In this case, <code><a href='https://rdrr.io/pkg/fasttime/man/fastPOSIXct.html'>fastPOSIXct</a></code> can be used to improve algorithm speed, if suitable. The default function is <code>function(x, tz = "UTC",...) fasttime::fastPOSIXct(x, tz = tz,...)</code>.</p></td>
    </tr>
    <tr>
      <th>detection_range</th>
      <td><p>A number that defines the maximum distance (m) between a transmitting receiver and other receivers within with detections may plausibly be received. For each transmission, all detections at active receivers within this distance are counted; other receivers are not considered.</p></td>
    </tr>
    <tr>
      <th>dist_btw_receivers</th>
      <td><p>(optional) A dataframe that specifies the distances between all combinations of receivers. If not provided, this is computed internally by <code><a href='dist_btw_receivers.html'>dist_btw_receivers</a></code>, which assumes Euclidean distances are appropriate. If provided, the dataframe should contain columns: `r1', `r2', `dist' (see <code><a href='dist_btw_receivers.html'>dist_btw_receivers</a></code>). Note that, if provided, the `dist' column should be in m, not km, as returned by default by <code><a href='dist_btw_receivers.html'>dist_btw_receivers</a></code>, to match the units of <code>detection_range</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns a dataframe that, for each source receiver (i.e., sentinel tag), specifies the number of transmissions from that receiver and the number of detections at each nearby receiver over the specified time window. The dataframe has the following columns: `timestamp_bin', the time window; `source_id', the identifier of the source of transmission; `sink_id', the identifier of each potential recipient of each transmission; `n_trms', the number of transmissions from the source over each time window; `n_dets', the number of detections of each transmission at each potential recipient receiver; `dist_btw_receivers', the distance between the source and the sink receiver. Rows are ordered by `source_id', then `timestamp' and finally `sink_id'.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Edward Lavender</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#### Example (1): Use default options and example dataframes, which contain</span>
<span class='co'># ... all required columns:</span>
<span class='va'>sentinel_counts</span> <span class='op'>&lt;-</span> <span class='fu'>assemble_sentinel_counts</span><span class='op'>(</span>sentinel <span class='op'>=</span> <span class='va'>dat_sentinel</span>,
                                            moorings <span class='op'>=</span> <span class='va'>dat_moorings</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>sentinel_counts</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='va'>sentinel_counts</span><span class='op'>)</span>;
</div><div class='output co'>#&gt;         timestamp_bin source_id sink_id n_trms n_dets dist_btw_receivers
#&gt; 1 2016-07-11 00:00:00        35      18     38      0           1011.998
#&gt; 2 2016-07-11 00:00:00        35      24     38      0            991.067
#&gt; 3 2016-07-11 00:00:00        35      38     38      0           1536.335
#&gt; 4 2016-07-11 01:00:00        35      18     39      0           1011.998
#&gt; 5 2016-07-11 01:00:00        35      24     39      0            991.067
#&gt; 6 2016-07-11 01:00:00        35      38     39      0           1536.335</div><div class='output co'>#&gt;            timestamp_bin source_id sink_id n_trms n_dets dist_btw_receivers
#&gt; 6892 2016-09-06 09:00:00        36      26     39      0           1951.914
#&gt; 6893 2016-09-06 09:00:00        36      31     39      0           1822.303
#&gt; 6894 2016-09-06 10:00:00        36      26     39      0           1951.914
#&gt; 6895 2016-09-06 10:00:00        36      31     39      0           1822.303
#&gt; 6896 2016-09-06 11:00:00        36      26     38      0           1951.914
#&gt; 6897 2016-09-06 11:00:00        36      31     38      0           1822.303</div><div class='input'>
<span class='co'>#### Example (2): Adjust time window</span>
<span class='va'>sentinel_counts</span> <span class='op'>&lt;-</span> <span class='fu'>assemble_sentinel_counts</span><span class='op'>(</span>sentinel <span class='op'>=</span> <span class='va'>dat_sentinel</span>,
                                            moorings <span class='op'>=</span> <span class='va'>dat_moorings</span>,
                                            breaks <span class='op'>=</span> <span class='st'>"days"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>sentinel_counts</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='va'>sentinel_counts</span><span class='op'>)</span>;
</div><div class='output co'>#&gt;   timestamp_bin source_id sink_id n_trms n_dets dist_btw_receivers
#&gt; 1    2016-07-11        35      18    925      0           1011.998
#&gt; 2    2016-07-11        35      24    925      0            991.067
#&gt; 3    2016-07-11        35      38    925      0           1536.335
#&gt; 4    2016-07-12        35      18    925      0           1011.998
#&gt; 5    2016-07-12        35      24    925      0            991.067
#&gt; 6    2016-07-12        35      38    925      0           1536.335</div><div class='output co'>#&gt;     timestamp_bin source_id sink_id n_trms n_dets dist_btw_receivers
#&gt; 285    2016-09-04        36      26    930      0           1951.914
#&gt; 286    2016-09-04        36      31    930      0           1822.303
#&gt; 287    2016-09-05        36      26    930      0           1951.914
#&gt; 288    2016-09-05        36      31    930      0           1822.303
#&gt; 289    2016-09-06        36      26    465      0           1951.914
#&gt; 290    2016-09-06        36      31    465      0           1822.303</div><div class='input'>
<span class='co'>#### Example (2): Adjust maximum detection distance and supply dist_btw_receivers</span>
<span class='va'>dist_btw_receivers_m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dist_btw_receivers.html'>dist_btw_receivers</a></span><span class='op'>(</span><span class='va'>dat_moorings</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"receiver_id"</span>,
                                                            <span class='st'>"receiver_long"</span>,
                                                            <span class='st'>"receiver_lat"</span><span class='op'>)</span><span class='op'>]</span>,
                                           f <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>*</span><span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>sentinel_counts</span> <span class='op'>&lt;-</span> <span class='fu'>assemble_sentinel_counts</span><span class='op'>(</span>sentinel <span class='op'>=</span> <span class='va'>dat_sentinel</span>,
                                            moorings <span class='op'>=</span> <span class='va'>dat_moorings</span>,
                                            detection_range <span class='op'>=</span> <span class='fl'>1500</span>,
                                            dist_btw_receivers <span class='op'>=</span> <span class='va'>dist_btw_receivers_m</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>sentinel_counts</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='va'>sentinel_counts</span><span class='op'>)</span>
</div><div class='output co'>#&gt;         timestamp_bin source_id sink_id n_trms n_dets dist_btw_receivers
#&gt; 1 2016-07-11 00:00:00        35      18     38      0           1011.998
#&gt; 2 2016-07-11 00:00:00        35      24     38      0            991.067
#&gt; 3 2016-07-11 01:00:00        35      18     39      0           1011.998
#&gt; 4 2016-07-11 01:00:00        35      24     39      0            991.067
#&gt; 5 2016-07-11 02:00:00        35      18     38      0           1011.998
#&gt; 6 2016-07-11 02:00:00        35      24     38      0            991.067</div><div class='output co'>#&gt;            timestamp_bin source_id sink_id n_trms n_dets dist_btw_receivers
#&gt; 2753 2016-09-06 08:00:00        35      18     39      0           1011.998
#&gt; 2754 2016-09-06 08:00:00        35      24     39      0            991.067
#&gt; 2755 2016-09-06 09:00:00        35      18     38      0           1011.998
#&gt; 2756 2016-09-06 09:00:00        35      24     38      0            991.067
#&gt; 2757 2016-09-06 10:00:00        35      18     16      0           1011.998
#&gt; 2758 2016-09-06 10:00:00        35      24     16      0            991.067</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


