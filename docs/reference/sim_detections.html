<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Simulate detections — sim_detections • flapper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Simulate detections — sim_detections" />
<meta property="og:description" content="This function simulates detections at passive acoustic telemetry receivers under a detection model that depends on distance. To implement the function, the underlying movement path that gives rise to detections (or not) must be supplied (via path) along with the locations of receivers (xy) at which detections can be made. At each point along the movement path (i.e., time step), the function calculates the distances from that point to all of the receivers and evaluates a user-supplied detection probability function, based on distance, to determine detection probability at each receiver. The function then simulates binary detection outcomes from a binomial distribution conditional on this probability, and returns these in a matrix with one simulated outcome for each time step and receiver." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flapper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/edwardlavender/flapper/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate detections</h1>
    <small class="dont-index">Source: <a href='https://github.com/edwardlavender/flapper/blob/master/R/sims.R'><code>R/sims.R</code></a></small>
    <div class="hidden name"><code>sim_detections.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function simulates detections at passive acoustic telemetry receivers under a detection model that depends on distance. To implement the function, the underlying movement path that gives rise to detections (or not) must be supplied (via <code>path</code>) along with the locations of receivers (<code>xy</code>) at which detections can be made. At each point along the movement path (i.e., time step), the function calculates the distances from that point to all of the receivers and evaluates a user-supplied detection probability function, based on distance, to determine detection probability at each receiver. The function then simulates binary detection outcomes from a binomial distribution conditional on this probability, and returns these in a matrix with one simulated outcome for each time step and receiver.</p>
    </div>

    <pre class="usage"><span class='fu'>sim_detections</span><span class='op'>(</span>
  <span class='va'>path</span>,
  <span class='va'>xy</span>,
  crs <span class='op'>=</span> <span class='cn'>NA</span>,
  <span class='va'>calc_detection_pr</span>,
  by_timestep <span class='op'>=</span> <span class='cn'>FALSE</span>,
  delta_t <span class='op'>=</span> <span class='cn'>NULL</span>,
  seed <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot <span class='op'>=</span> <span class='cn'>TRUE</span>,
  jitter <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>0</span>, <span class='fl'>0.05</span><span class='op'>)</span>,
  add_prob <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>col <span class='op'>=</span> <span class='st'>"royalblue"</span>, pch <span class='op'>=</span> <span class='fl'>3</span>, cex <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,
  xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1000</span><span class='op'>)</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>path</th>
      <td><p>A two-column matrix of the coordinates of the movement path (x, y).</p></td>
    </tr>
    <tr>
      <th>xy</th>
      <td><p>A two-column matrix of the coordinates of receivers (x, y).</p></td>
    </tr>
    <tr>
      <th>crs</th>
      <td><p>A <code><a href='https://rdrr.io/pkg/sp/man/CRS-class.html'>CRS</a></code> object that defines the coordinate reference system (CRS) for <code>path</code> and <code>xy</code> (if applicable).</p></td>
    </tr>
    <tr>
      <th>calc_detection_pr</th>
      <td><p>A function that takes in a vector of distances and returns a vector of detection probabilities.</p></td>
    </tr>
    <tr>
      <th>by_timestep</th>
      <td><p>A logical variable that defines whether or not <code>calc_detection_pr</code> needs to be applied to each time step separately. This may be necessary if some of the parameters of the detection model are vectors (see Examples).</p></td>
    </tr>
    <tr>
      <th>delta_t</th>
      <td><p>(optional) An integer that defines the number of time steps over which to aggregate detections. If provided, detections are summed over each <code>delta_t</code> interval and returned along with averaged distances and probabilities (see Value).</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>An integer that is used to set the seed to enable reproducible simulations (see <code><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></code>).</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>A logical variable that defines whether or not to plot detections (and probabilities) against distances.</p></td>
    </tr>
    <tr>
      <th>jitter, add_prob, xlim, ...</th>
      <td><p>Plot customisation options. <code>jitter</code> is a function that jitters <code>n</code> simulated outcomes (0, 1) in the vertical direction. <code>add_prob</code> is a named list of arguments, passed to <code><a href='https://rdrr.io/r/graphics/points.html'>points</a></code>, used to customise the addition of calculated probabilities to the plot. (<code>add_prob = NULL</code> suppresses the addition of probabilities to the plot.) <code>xlim</code> is a vector of x axis limits. By default, <code>xlim = c(0, 1000)</code> to improve resolution in the area of the plot that is of interest (under a Universal Transverse Mercator CRS, for most realistic detection probability functions, detection probability beyond 1000 will be negligible) and plotting speed. Additional arguments can be passed to <code><a href='https://edwardlavender.github.io/prettyGraphics/reference/pretty_plot.html'>pretty_plot</a></code> to customise the plot via <code>...</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>A logical variable that defines whether or not to print messages to the console to relay function progress.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>delta_t = NULL</code>, then function returns a named list with three matrices that define, for each path position (rows) and each receiver (columns), (a) the distance of that position from each receiver (`dist_mat'), (b) the probability of detection at that receiver (`prob_mat') and (c) the simulated outcome (0, no detection; 1, detection) (`det_mat'). If <code>delta_t</code> is specified, then the function returns a list with a `raw' and an `agg' element. The raw elements contains the matrices described above; the `agg' element contains the aggregated versions of these matrices, with detections summed over each <code>delta_t</code> interval and distances and probabilities averaged (using the arithmetic mean) over each interval. If <code>plot = TRUE</code>, the function also returns a plot of the (raw) detections (0, 1) and, if specified, the corresponding probabilities.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function assumes that the individual transmits an acoustic signal which has the capacity to be detected at each time step. In reality, acoustic transmitters are often programmed with a randomly varying delay, but this is not currently implemented. The function also assumes that all receivers that are supplied are able to make detections. If the receivers at which an individual could be detected change over time, it may be necessary to apply the function iteratively or post-process the outcomes to ensure that individuals are not detected at inactive receivers.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='sim_array.html'>sim_array</a></code>, <code><a href='sim_path_*.html'>sim_path_*</a></code> and <code>sim_detections</code> provide an integrated workflow for simulating acoustic arrays, movement paths in these areas and detections at receivers arising from movement. To convert the detection matrix to dataframe, see <code><a href='make_df_detections.html'>make_df_detections</a></code>.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Edward Lavender</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#### Step (1) Simulate an array in an area</span>
<span class='va'>array_ls</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_array.html'>sim_array</a></span><span class='op'>(</span>boundaries <span class='op'>=</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extent.html'>extent</a></span><span class='op'>(</span><span class='va'>dat_coast</span><span class='op'>)</span>,
                      coastline <span class='op'>=</span> <span class='va'>dat_coast</span>,
                      n_receivers <span class='op'>=</span> <span class='fl'>100</span>,
                      arrangement <span class='op'>=</span> <span class='st'>"regular"</span>,
                      seed <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::sim_array() called (@ 2021-12-02 12:00:37)... 
#&gt; ... Defining area... 
#&gt; ... Incorporating coastline... 
#&gt; ... Incorporating receivers... 
#&gt; ... ... Simulating receivers... </div><div class='output co'>#&gt; <span class='warning'>Warning: CRS object has comment, which is lost in output</span></div><div class='output co'>#&gt; ... Plotting array... </div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: '+proj=utm +zone=29 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs'.</span></div><div class='output co'>#&gt; ... Defining outputs... 
#&gt; ... flapper::sim_array() call completed (@ 2021-12-02 12:00:37) after ~0 minutes. </div><div class='input'><span class='fu'>raster</span><span class='fu'>::</span><span class='fu'>lines</span><span class='op'>(</span><span class='va'>dat_coast</span><span class='op'>)</span>
</div><div class='input'>
<span class='co'>#### Step (2) Simulate a movement path in this area</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>500</span>
<span class='va'>path_ls</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_path_sa.html'>sim_path_sa</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>n</span>,
                       sim_step <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>1</span>, shape <span class='op'>=</span> <span class='fl'>25</span>, scale <span class='op'>=</span> <span class='fl'>25</span><span class='op'>)</span>,
                       area <span class='op'>=</span> <span class='va'>array_ls</span><span class='op'>$</span><span class='va'>array</span><span class='op'>$</span><span class='va'>sea</span>,
                       seed <span class='op'>=</span> <span class='fl'>1</span>,
                       plot <span class='op'>=</span> <span class='cn'>FALSE</span>
                       <span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::sim_path_sa() called (@ 2021-12-02 12:00:37)... 
#&gt; ... Setting up simulation... 
#&gt; ... Simulating movement path... 
#&gt;   |                                                                              |                                                                      |   0%</div><div class='output co'>#&gt; <span class='warning'>Warning: CRS object has comment, which is lost in output</span></div><div class='output co'>#&gt;   |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%... flapper::sim_path_sa() call completed (@ 2021-12-02 12:00:38) after ~0.01 minutes. </div><div class='input'><span class='fu'>prettyGraphics</span><span class='fu'>::</span><span class='fu'><a href='https://edwardlavender.github.io/prettyGraphics/reference/add_sp.html'>add_sp_path</a></span><span class='op'>(</span><span class='va'>path_ls</span><span class='op'>$</span><span class='va'>xy_mat</span>, col <span class='op'>=</span> <span class='fu'>viridis</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/viridisLite/man/viridis.html'>viridis</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, length <span class='op'>=</span> <span class='fl'>0.02</span><span class='op'>)</span>
</div><div class='img'><img src='sim_detections-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>#### Step (3) Simulate detections</span>
<span class='co'>## (A) Extract path and receiver coordinates from simulated outcomes above</span>
<span class='va'>path</span> <span class='op'>&lt;-</span> <span class='va'>path_ls</span><span class='op'>$</span><span class='va'>xy_mat</span>
<span class='va'>xy</span>   <span class='op'>&lt;-</span> <span class='va'>array_ls</span><span class='op'>$</span><span class='va'>array</span><span class='op'>$</span><span class='va'>xy</span>
<span class='va'>xy</span>   <span class='op'>&lt;-</span> <span class='fu'>sp</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>xy</span><span class='op'>)</span>
<span class='co'>## (B) Simulate detections under different probability functions (see below).</span>

<span class='co'>#### Example (1) Threshold probability function</span>
<span class='co'># Define detection pr function</span>
<span class='va'>calc_detection_pr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>dist</span> <span class='op'>&lt;</span> <span class='fl'>425</span>, <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>
<span class='co'># Simulate detections</span>
<span class='va'>dets_sim</span> <span class='op'>&lt;-</span> <span class='fu'>sim_detections</span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>path</span>,
                           xy <span class='op'>=</span> <span class='va'>xy</span>,
                           calc_detection_pr <span class='op'>=</span> <span class='va'>calc_detection_pr</span><span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::sim_detections() called (@ 2021-12-02 12:00:38)... 
#&gt; ... Setting up simulation... 
#&gt; ... Calculating distances... 
#&gt; ... Calculating probabilities... 
#&gt; ... Simulating detections... 
#&gt; ... Plotting detections... </div><div class='img'><img src='sim_detections-2.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; ... flapper::simulate_detections() call completed (@ 2021-12-02 12:00:38) after ~0 minutes. </div><div class='input'><span class='co'># The function returns a list of matrices that define the distances,</span>
<span class='co'># ... probabilities and detections for each time stamp (row) and each receiver</span>
<span class='co'># ... (column)</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>dets_sim</span><span class='op'>)</span>
</div><div class='output co'>#&gt; List of 3
#&gt;  $ dist_mat: num [1:500, 1:116] 19067 18554 18094 17367 16872 ...
#&gt;  $ prob_mat: num [1:500, 1:116] 0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ det_mat : int [1:500, 1:116] 0 0 0 0 0 0 0 0 0 0 ...</div><div class='input'><span class='co'># Examine probabilities</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>dets_sim</span><span class='op'>$</span><span class='va'>prob_mat</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;     0     1 
#&gt; 57852   148 </div><div class='input'><span class='co'># We can also aggregate detections via delta_t</span>
<span class='va'>dets_sim</span> <span class='op'>&lt;-</span> <span class='fu'>sim_detections</span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>path</span>,
                           xy <span class='op'>=</span> <span class='va'>xy</span>,
                           calc_detection_pr <span class='op'>=</span> <span class='va'>calc_detection_pr</span>,
                           delta_t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::sim_detections() called (@ 2021-12-02 12:00:38)... 
#&gt; ... Setting up simulation... 
#&gt; ... Calculating distances... 
#&gt; ... Calculating probabilities... 
#&gt; ... Simulating detections... 
#&gt; ... Plotting detections... </div><div class='img'><img src='sim_detections-3.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; ... summarising detections over delta t... 
#&gt; ... flapper::simulate_detections() call completed (@ 2021-12-02 12:00:38) after ~0 minutes. </div><div class='input'><span class='co'># In this case, the function returns a list with 'agg' and 'raw' elements</span>
<span class='co'># ... The 'agg' elements contain aggregated matrices and the 'raw' elements</span>
<span class='co'># ... contain the matrices described above.</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>dets_sim</span><span class='op'>)</span>
</div><div class='output co'>#&gt; List of 2
#&gt;  $ agg:List of 3
#&gt;   ..$ dist_mat: num [1:50, 1:116] 173735 163252 172967 184119 163313 ...
#&gt;   ..$ prob_mat: num [1:50, 1:116] 0 0 0 0 0 0 0 0 0 0 ...
#&gt;   ..$ det_mat : num [1:50, 1:116] 0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ raw:List of 3
#&gt;   ..$ dist_mat_raw: num [1:500, 1:116] 19067 18554 18094 17367 16872 ...
#&gt;   ..$ prob_mat_raw: num [1:500, 1:116] 0 0 0 0 0 0 0 0 0 0 ...
#&gt;   ..$ det_mat_raw : int [1:500, 1:116] 0 0 0 0 0 0 0 0 0 0 ...</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>dets_sim</span><span class='op'>$</span><span class='va'>raw</span><span class='op'>$</span><span class='va'>det_mat</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;     0     1 
#&gt; 57852   148 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>dets_sim</span><span class='op'>$</span><span class='va'>agg</span><span class='op'>$</span><span class='va'>det_mat</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;    0    1    2    3    4 
#&gt; 5701   61   29    7    2 </div><div class='input'>
<span class='co'>#### Example (2) Logistic probability function</span>
<span class='va'>calc_detection_pr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='fl'>2.5</span> <span class='op'>+</span> <span class='op'>-</span><span class='fl'>0.01</span> <span class='op'>*</span> <span class='va'>dist</span><span class='op'>)</span>
<span class='va'>dets_sim</span> <span class='op'>&lt;-</span> <span class='fu'>sim_detections</span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>path</span>,
                           xy <span class='op'>=</span> <span class='va'>xy</span>,
                           calc_detection_pr <span class='op'>=</span> <span class='va'>calc_detection_pr</span><span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::sim_detections() called (@ 2021-12-02 12:00:38)... 
#&gt; ... Setting up simulation... 
#&gt; ... Calculating distances... 
#&gt; ... Calculating probabilities... 
#&gt; ... Simulating detections... 
#&gt; ... Plotting detections... </div><div class='img'><img src='sim_detections-4.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; ... flapper::simulate_detections() call completed (@ 2021-12-02 12:00:39) after ~0.01 minutes. </div><div class='input'>
<span class='co'>#### Example (3) Spatially varying probability function</span>
<span class='co'># Define spatially varying beta parameter (e.g., reflecting 2 habitat types)</span>
<span class='va'>area</span> <span class='op'>&lt;-</span> <span class='va'>array_ls</span><span class='op'>$</span><span class='va'>array</span><span class='op'>$</span><span class='va'>area</span>
<span class='va'>area_r</span> <span class='op'>&lt;-</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extent.html'>extent</a></span><span class='op'>(</span><span class='va'>area</span><span class='op'>)</span>,
                         crs <span class='op'>=</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>area</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>area_r</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0L</span>
<span class='va'>beta_surface</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_surface.html'>sim_surface</a></span><span class='op'>(</span>blank <span class='op'>=</span> <span class='va'>area_r</span>,
                            n <span class='op'>=</span> <span class='fl'>2L</span>,
                            sim_values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>-</span><span class='fl'>0.05</span>,
                                              <span class='kw'>function</span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>-</span><span class='fl'>0.01</span><span class='op'>)</span>,
                            mask <span class='op'>=</span> <span class='va'>array_ls</span><span class='op'>$</span><span class='va'>array</span><span class='op'>$</span><span class='va'>sea</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>prettyGraphics::pretty_map() CRS taken as: '+proj=utm +zone=29 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs'.</span></div><div class='img'><img src='sim_detections-5.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># Extract receiver specific beta values</span>
<span class='va'>xy_sp</span> <span class='op'>&lt;-</span> <span class='fu'>sp</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/SpatialPoints.html'>SpatialPoints</a></span><span class='op'>(</span><span class='va'>xy</span>, proj4string <span class='op'>=</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>area_r</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>beta</span> <span class='op'>&lt;-</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extract.html'>extract</a></span><span class='op'>(</span><span class='va'>beta_surface</span>, <span class='va'>xy_sp</span><span class='op'>)</span>
<span class='co'># Visualise simulated detection probability surface at some suitable distances</span>
<span class='va'>pp</span> <span class='op'>&lt;-</span> <span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>50</span>, <span class='fl'>100</span>, <span class='fl'>500</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/calc.html'>calc</a></span><span class='op'>(</span><span class='va'>beta_surface</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>beta</span><span class='op'>)</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='fl'>2.5</span> <span class='op'>+</span> <span class='va'>beta</span> <span class='op'>*</span> <span class='va'>dist</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>r</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
</div><div class='img'><img src='sim_detections-6.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; [[1]]
#&gt; NULL
#&gt; 
#&gt; [[2]]
#&gt; NULL
#&gt; 
#&gt; [[3]]
#&gt; NULL
#&gt; 
#&gt; [[4]]
#&gt; NULL
#&gt; </div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span><span class='va'>pp</span><span class='op'>)</span>
<span class='co'># Define detection probability function</span>
<span class='va'>calc_detection_pr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='fl'>2.5</span> <span class='op'>+</span> <span class='va'>beta</span> <span class='op'>*</span> <span class='va'>dist</span><span class='op'>)</span>
<span class='co'># Simulate detections</span>
<span class='co'># ... Define by_timestep = TRUE so that that distances from each receiver</span>
<span class='co'># ... are combined appropriately with beta values for each receiver</span>
<span class='va'>dets_sim</span> <span class='op'>&lt;-</span> <span class='fu'>sim_detections</span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>path</span>,
                           xy <span class='op'>=</span> <span class='va'>xy</span>,
                           calc_detection_pr <span class='op'>=</span> <span class='va'>calc_detection_pr</span>,
                           by_timestep <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; flapper::sim_detections() called (@ 2021-12-02 12:00:39)... 
#&gt; ... Setting up simulation... 
#&gt; ... Calculating distances... 
#&gt; ... Calculating probabilities... 
#&gt; ... Simulating detections... </div><div class='output co'>#&gt; <span class='warning'>Warning: NAs produced</span></div><div class='output co'>#&gt; ... Plotting detections... </div><div class='output co'>#&gt; <span class='message'>22 observation pair(s) in x are NA; these are removed.</span></div><div class='img'><img src='sim_detections-7.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; ... flapper::simulate_detections() call completed (@ 2021-12-02 12:00:39) after ~0 minutes. </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edward Lavender.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


